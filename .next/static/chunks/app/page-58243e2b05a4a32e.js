(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7678:function(e,a,s){Promise.resolve().then(s.bind(s,4203))},4203:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return x}});var t=s(7437),n=s(2265);let r=(0,s(9073).eI)("https://enreskfzejsoiyzfrxmq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVucmVza2Z6ZWpzb2l5emZyeG1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NDYwODMsImV4cCI6MjA4NDMyMjA4M30.deO_NVs9tP_ds7crQyDRJXtEWtB3YPHF7UDeVYiOlz0");class i{static getCurrentTime(e){let a=e.current_year-e.birth_year,s=this.getSeason(a),t=a%12+1;return{currentYear:e.current_year,currentSeason:s,currentMonth:t}}static getSeason(e){return this.SEASONS[e%4]}static advanceTime(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=e.current_year+Math.floor(a/12),t=e.age+Math.floor(a/12);return{...e,current_year:s,age:t,is_alive:t<80,death_reason:t>=80?"velhice":e.death_reason}}static getAgeEvents(e){let a=[];return 16===e&&a.push({age:16,title:"Cerim\xf4nia de Maioridade",description:"Voc\xea completou 16 anos e est\xe1 pronto para se tornar um guerreiro. Seu cl\xe3 organiza uma cerim\xf4nia para marcar sua transi\xe7\xe3o para a vida adulta.",choices:[{text:"Dedicar-se ao treinamento de espada",consequence:"Voc\xea se torna um espadachim habilidoso, mas negligencia seus estudos.",effects:{strength:5,intelligence:-2}},{text:"Estudar estrat\xe9gia com os anci\xe3os",consequence:"Voc\xea se torna um estrategista brilhante, mas sua for\xe7a f\xedsica fica aqu\xe9m do esperado.",effects:{intelligence:5,strength:-2}},{text:"Equilibrar treinamento e estudos",consequence:"Voc\xea se torna um guerreiro completo, embora n\xe3o se destaque em nenhuma \xe1rea espec\xedfica.",effects:{strength:2,intelligence:2}}]}),20===e&&a.push({age:20,title:"Primeira Batalha",description:"Seu cl\xe3 est\xe1 em conflito com um cl\xe3 rival. Esta \xe9 sua primeira verdadeira batalha como samurai.",choices:[{text:"Lutar na linha de frente",consequence:"Sua coragem \xe9 notada, mas voc\xea sofre ferimentos graves.",effects:{honor:10,health:-20}},{text:"Atuar como arqueiro de apoio",consequence:"Voc\xea contribui para a vit\xf3ria sem se expor demais.",effects:{honor:5,health:-5}},{text:"Proteger o comandante",consequence:"Sua lealdade \xe9 recompensada com promo\xe7\xe3o.",effects:{honor:15,gold:20}}]}),25===e&&a.push({age:25,title:"Casamento Arranjado",description:"Seu cl\xe3 prop\xf5e um casamento estrat\xe9gico com outro cl\xe3 para fortalecer alian\xe7as.",choices:[{text:"Aceitar o casamento",consequence:"A alian\xe7a fortalece seu cl\xe3, mas voc\xea sacrifica seu amor pessoal.",effects:{honor:10,charisma:3}},{text:"Recusar educadamente",consequence:"Voc\xea mant\xe9m sua liberdade, mas desagrada alguns anci\xe3os.",effects:{honor:-5,charisma:5}},{text:"Negociar melhores termos",consequence:"Voc\xea demonstra sabedoria pol\xedtica e obt\xe9m vantagens.",effects:{intelligence:5,gold:30}}]}),35===e&&a.push({age:35,title:"Posi\xe7\xe3o de Lideran\xe7a",description:"Sua experi\xeancia e reputa\xe7\xe3o lhe rendem uma posi\xe7\xe3o de lideran\xe7a no cl\xe3.",choices:[{text:"Aceitar o cargo de comandante",consequence:"Voc\xea se torna um l\xedder respeitado, mas o peso da responsabilidade \xe9 grande.",effects:{honor:20,health:-10}},{text:"Tornar-se conselheiro",consequence:"Voc\xea influencia as decis\xf5es sem o fardo do comando direto.",effects:{intelligence:10,honor:10}},{text:"Recusar para manter liberdade",consequence:"Voc\xea prefere a liberdade do campo de batalha \xe0 pol\xedtica.",effects:{strength:5,charisma:-5}}]}),50===e&&a.push({age:50,title:"Herdeiro",description:"Seus filhos j\xe1 cresceram e est\xe3o prontos para seguir seus passos.",choices:[{text:"Treinar seu filho mais velho",consequence:"Seu filho se torna um guerreiro digno de seu legado.",effects:{honor:15,charisma:5}},{text:"Deixar os filhos escolherem seus caminhos",consequence:"Seus filhos encontram seus pr\xf3prios destinos.",effects:{intelligence:5,honor:5}},{text:"Aposentar-se e meditar",consequence:"Voc\xea encontra paz interior na velhice.",effects:{health:20,intelligence:10}}]}),a}static checkDeath(e){if(e.age>=80)return{isDead:!0,reason:"velhice"};if(e.health<=0)return{isDead:!0,reason:"ferimentos"};if(e.age>=60&&Math.random()<(e.age-60)*.01){let e=["doen\xe7a","acidente","envenenamento"];return{isDead:!0,reason:e[Math.floor(Math.random()*e.length)]}}return{isDead:!1}}}function c(e){let{character:a,onCharacterUpdate:s}=e,[c,o]=(0,n.useState)(i.getCurrentTime(a)),[l,d]=(0,n.useState)(null),[m,u]=(0,n.useState)([]);(0,n.useEffect)(()=>{let e=i.getAgeEvents(a.age).find(e=>!0);e&&d(e)},[a.age]);let x=async e=>{if(!l)return;let t={...a,health:Math.max(0,Math.min(100,a.health+(e.effects.health||0))),honor:Math.max(0,Math.min(100,a.honor+(e.effects.honor||0))),gold:Math.max(0,a.gold+(e.effects.gold||0)),strength:Math.max(1,a.strength+(e.effects.strength||0)),agility:Math.max(1,a.agility+(e.effects.agility||0)),intelligence:Math.max(1,a.intelligence+(e.effects.intelligence||0)),charisma:Math.max(1,a.charisma+(e.effects.charisma||0))},{error:n}=await r.from("characters").update(t).eq("id",a.id);if(n){alert("Erro ao salvar: "+n.message);return}u(a=>["".concat(c.currentYear," - ").concat(l.title),"Sua escolha: ".concat(e.text),e.consequence,"",...a]),await r.from("game_events").insert({character_id:a.id,event_type:"age_event",title:l.title,description:l.description,choices:l.choices.map(e=>e.text),consequences:[e.consequence],year:c.currentYear});let m=i.checkDeath(t);if(m.isDead){let e={...t,is_alive:!1,death_reason:m.reason};await r.from("characters").update(e).eq("id",a.id),s(e),alert("Seu personagem morreu de ".concat(m.reason," aos ").concat(t.age," anos."));return}s(t),d(null);let x=i.advanceTime(t,12);o(i.getCurrentTime(x))},p=async()=>{let e=i.advanceTime(a,12),{error:t}=await r.from("characters").update(e).eq("id",a.id);if(t){alert("Erro ao avan\xe7ar tempo: "+t.message);return}s(e),o(i.getCurrentTime(e));let n=i.getAgeEvents(e.age).find(a=>a.age===e.age);n&&d(n)};return a.is_alive?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"character-status p-6",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-4 text-japan-gold",children:a.name}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-japan-cream",children:"Profiss\xe3o:"}),(0,t.jsx)("div",{className:"text-japan-gold font-bold",children:a.profession||"Ferreiro"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-japan-cream",children:"Origem:"}),(0,t.jsx)("div",{className:"text-japan-gold font-bold",children:a.clan})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-japan-cream",children:"Localiza\xe7\xe3o:"}),(0,t.jsx)("div",{className:"text-japan-gold font-bold",children:a.current_location||"Vila de origem"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-japan-cream",children:"Status:"}),(0,t.jsx)("div",{className:"text-japan-gold font-bold",children:a.is_alive?"Vivo":"Morto"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-japan-cream",children:"Hor\xe1rio:"}),(0,t.jsx)("div",{className:"text-japan-gold font-bold",children:gameTime})]})]}),a.travel_reason&&(0,t.jsx)("div",{className:"mt-4 p-3 bg-japan-black rounded",children:(0,t.jsxs)("div",{className:"text-japan-cream text-sm",children:[(0,t.jsx)("strong",{children:"Motivo da viagem:"})," ",a.travel_reason]})})]}),(0,t.jsxs)("div",{className:"flex gap-2 mb-6 flex-wrap",children:[(0,t.jsx)("button",{onClick:()=>setCurrentView("status"),className:"japan-button px-4 py-2 ".concat("status"===currentView?"bg-japan-red":""),children:"\uD83D\uDCCB Status"}),(0,t.jsx)("button",{onClick:()=>setCurrentView("combat"),className:"japan-button px-4 py-2 ".concat("combat"===currentView?"bg-japan-red":""),children:"⚔️ Combate"}),(0,t.jsx)("button",{onClick:()=>setCurrentView("occult"),className:"japan-button px-4 py-2 ".concat("occult"===currentView?"bg-japan-red":""),children:"\uD83C\uDF11 Oculto"}),(0,t.jsx)("button",{onClick:()=>setCurrentView("secrets"),className:"japan-button px-4 py-2 ".concat("secrets"===currentView?"bg-japan-red":""),children:"\uD83C\uDF11 Caminhos"}),(0,t.jsx)("button",{onClick:()=>setCurrentView("encounters"),className:"japan-button px-4 py-2 ".concat("encounters"===currentView?"bg-japan-red":""),children:"\uD83D\uDC41️ Encontros"})]}),"status"===currentView&&(0,t.jsxs)("div",{className:"text-sm text-japan-cream opacity-70",children:[(0,t.jsxs)("p",{children:["\uD83C\uDF05 ",(0,t.jsx)("strong",{children:"Bem-vindo ao Jap\xe3o feudal"})]}),(0,t.jsxs)("p",{children:["\uD83D\uDC65 ",(0,t.jsx)("strong",{children:"Voc\xea \xe9 uma pessoa comum tentando sobreviver"})]}),(0,t.jsxs)("p",{children:["\uD83D\uDDFA️ ",(0,t.jsx)("strong",{children:"O mapa mostra suas op\xe7\xf5es de viagem"})]}),(0,t.jsxs)("p",{children:["⚔️ ",(0,t.jsx)("strong",{children:"Evite conflitos sempre que poss\xedvel"})]})]}),"combat"===currentView&&(0,t.jsx)(CombatSystem,{characterId:a.id,onCombatEnd:e=>{console.log("Combat result:",e),e.playerInjured&&alert("Seu personagem sofreu ferimentos e precisar\xe1 de descanso."),e.playerGainedExperience&&alert("Seu personagem aprendeu algo com essa experi\xeancia.")}}),"occult"===currentView&&(0,t.jsx)(OccultSystem,{characterId:a.id,onOccultEvent:e=>{console.log("Occult event:",e),e.perceptionGained&&alert("Sua percep\xe7\xe3o do oculto aumentou!"),e.spiritualResistanceGained&&alert("Sua resist\xeancia espiritual aumentou!")}}),"secrets"===currentView&&(0,t.jsx)(SecretSociety,{characterId:a.id,onSecretDiscovered:e=>{console.log("Secret discovered:",e),alert("Voc\xea descobriu o caminho secreto: ".concat(e.name,"!"))}}),"encounters"===currentView&&(0,t.jsx)(CreatureEncounters,{characterId:a.id,onEncounter:e=>{console.log("Creature encounter:",e),alert("Encontro an\xf4malo: ".concat(e.name))}}),l&&(0,t.jsxs)("div",{className:"japan-border p-6 bg-japan-black",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-4 text-japan-red",children:l.title}),(0,t.jsx)("p",{className:"text-scene mb-6",children:l.description}),(0,t.jsx)("div",{className:"space-y-3",children:l.choices.map((e,a)=>(0,t.jsx)("button",{onClick:()=>x(e),className:"japan-button w-full text-left p-4",children:e.text},a))})]}),!l&&(0,t.jsxs)("div",{className:"japan-border p-6 bg-japan-black text-center",children:[(0,t.jsx)("p",{className:"text-scene mb-4",children:"O tempo passa calmamente no Jap\xe3o feudal..."}),(0,t.jsx)("button",{onClick:p,className:"japan-button px-8 py-3",children:"Avan\xe7ar 1 Ano"})]}),m.length>0&&(0,t.jsxs)("div",{className:"japan-border p-4 bg-japan-black",children:[(0,t.jsx)("h4",{className:"text-sm font-bold mb-2 text-japan-gold",children:"Hist\xf3rico"}),(0,t.jsx)("div",{className:"text-xs space-y-1 max-h-32 overflow-y-auto",children:m.map((e,a)=>(0,t.jsx)("div",{className:"text-japan-cream opacity-80",children:e},a))})]})]}):(0,t.jsxs)("div",{className:"japan-border p-8 bg-japan-black",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-japan-red",children:"Fim da Jornada"}),(0,t.jsxs)("div",{className:"text-center text-scene",children:[(0,t.jsxs)("p",{className:"mb-4",children:["Seu personagem ",a.name," viveu uma vida completa no per\xedodo Sengoku."]}),(0,t.jsxs)("p",{className:"mb-4",children:["Morreu aos ",a.age," anos de ",a.death_reason||"causas naturais","."]}),(0,t.jsxs)("p",{className:"text-japan-gold",children:["Honra final: ",a.honor," | Ouro acumulado: ",a.gold]})]})]})}function o(e){let{userId:a,onSelectCharacter:s}=e,[i,o]=(0,n.useState)([]),[l,d]=(0,n.useState)(null),[m,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{x()},[a]);let x=async()=>{let{data:e,error:s}=await r.from("characters").select("*").eq("user_id",a).order("created_at",{ascending:!1});s?console.error("Erro ao carregar personagens:",s):o(e||[]),u(!1)},p=async e=>{if(!confirm("Tem certeza que deseja deletar este personagem?"))return;let{error:a}=await r.from("characters").delete().eq("id",e);a?alert("Erro ao deletar personagem: "+a.message):(o(a=>a.filter(a=>a.id!==e)),(null==l?void 0:l.id)===e&&d(null))};return m?(0,t.jsx)("div",{className:"text-japan-cream",children:"Carregando personagens..."}):l?(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{onClick:()=>d(null),className:"japan-button mb-4",children:"← Voltar para Personagens"}),(0,t.jsx)(c,{character:l,onCharacterUpdate:e=>{o(a=>a.map(a=>a.id===e.id?e:a)),d(e)}})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-japan-red",children:"Seus Personagens"}),0===i.length?(0,t.jsxs)("div",{className:"japan-border p-8 bg-japan-black text-center",children:[(0,t.jsx)("p",{className:"text-japan-cream mb-4",children:"Voc\xea ainda n\xe3o tem personagens criados."}),(0,t.jsx)("p",{className:"text-japan-cream",children:"Volte para a p\xe1gina inicial e crie seu primeiro personagem!"})]}):(0,t.jsx)("div",{className:"grid gap-4",children:i.map(e=>(0,t.jsx)("div",{className:"japan-border p-6 bg-japan-black",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-japan-gold mb-2",children:e.name}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-japan-cream",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-japan-gold",children:"Idade:"})," ",e.age," anos"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-japan-gold",children:"Origem:"})," ",e.clan]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-japan-gold",children:"Status:"})," ",e.is_alive?"Vivo":"Morto"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-japan-gold",children:"Honra:"})," ",e.honor]})]}),!e.is_alive&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-japan-red",children:["Causa da morte: ",e.death_reason||"Desconhecida"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[s&&(0,t.jsx)("button",{onClick:()=>s(e),className:"japan-button px-4 py-2 text-sm",children:"\uD83D\uDDFA️ Mapa"}),(0,t.jsx)("button",{onClick:()=>d(e),className:"japan-button px-4 py-2",children:e.is_alive?"Jogar":"Ver Hist\xf3ria"}),(0,t.jsx)("button",{onClick:()=>p(e.id),className:"px-4 py-2 border border-japan-red text-japan-red hover:bg-japan-red hover:text-japan-cream transition-colors",children:"Deletar"})]})]})},e.id))})]})}function l(e){let{userId:a}=e,[s,i]=(0,n.useState)([]),[c,o]=(0,n.useState)([]),[l,d]=(0,n.useState)(""),[m,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{x(),p();let e=r.channel("friends_status").on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles"},e=>{i(a=>a.map(a=>a.id===e.new.id?{...a,is_online:e.new.is_online}:a))}).subscribe();return()=>{e.unsubscribe()}},[a]);let x=async()=>{let{data:e,error:s}=await r.from("friends").select("\n        friend_id,\n        profiles!friend_id (\n          id,\n          username,\n          full_name,\n          is_online,\n          last_seen\n        )\n      ").eq("user_id",a);e&&!s&&i(e.map(e=>e.profiles).filter(e=>null!==e).map(e=>({id:e.id,username:e.username,full_name:e.full_name,is_online:e.is_online,last_seen:e.last_seen}))),u(!1)},p=async()=>{let{data:e,error:s}=await r.from("friend_requests").select("\n        id,\n        sender_id,\n        sender_username,\n        created_at\n      ").eq("receiver_id",a).eq("status","pending");e&&!s&&o(e.map(e=>({id:e.id,sender_id:e.sender_id,receiver_id:a,sender_username:e.sender_username,created_at:e.created_at})))},h=async()=>{var e;if(!l.trim())return;let{data:s,error:t}=await r.from("profiles").select("id, username").eq("email",l.trim()).single();if(t||!s){alert("Usu\xe1rio n\xe3o encontrado");return}let{data:n}=await r.from("friends").select("id").or("(user_id.eq.".concat(a,",friend_id.eq.").concat(s.id,"),(user_id.eq.").concat(s.id,",friend_id.eq.").concat(a,")")).single();if(n){alert("Voc\xeas j\xe1 s\xe3o amigos");return}let{error:i}=await r.from("friend_requests").insert({sender_id:a,receiver_id:s.id,sender_username:null===(e=(await r.from("profiles").select("username").eq("id",a).single()).data)||void 0===e?void 0:e.username});i?alert("Erro ao enviar solicita\xe7\xe3o: "+i.message):(alert("Solicita\xe7\xe3o enviada!"),d(""))},j=async(e,s)=>{let{error:t}=await r.from("friends").insert([{user_id:a,friend_id:s},{user_id:s,friend_id:a}]);if(t){alert("Erro ao aceitar solicita\xe7\xe3o: "+t.message);return}let{error:n}=await r.from("friend_requests").update({status:"accepted"}).eq("id",e);n?alert("Erro ao atualizar solicita\xe7\xe3o: "+n.message):(o(a=>a.filter(a=>a.id!==e)),x())},g=async e=>{let{error:a}=await r.from("friend_requests").update({status:"rejected"}).eq("id",e);a?alert("Erro ao rejeitar solicita\xe7\xe3o: "+a.message):o(a=>a.filter(a=>a.id!==e))},v=async e=>{alert("Convite enviado para o amigo! (ID: ".concat(e,")"))};return m?(0,t.jsx)("div",{className:"text-japan-cream",children:"Carregando amigos..."}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"character-status p-4",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-4 text-japan-gold",children:"\uD83D\uDC65 Adicionar Amigo"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"email",value:l,onChange:e=>d(e.target.value),placeholder:"Email do amigo",className:"flex-1 p-2 japan-input text-japan-cream"}),(0,t.jsx)("button",{onClick:h,className:"japan-button px-4 py-2",children:"Enviar"})]})]}),c.length>0&&(0,t.jsxs)("div",{className:"character-status p-4",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-4 text-japan-gold",children:"\uD83D\uDCE8 Solicita\xe7\xf5es"}),(0,t.jsx)("div",{className:"space-y-2",children:c.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-japan-black rounded",children:[(0,t.jsx)("span",{className:"text-japan-cream",children:e.sender_username}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>j(e.id,e.sender_id),className:"japan-button px-3 py-1 text-sm",children:"Aceitar"}),(0,t.jsx)("button",{onClick:()=>g(e.id),className:"japan-button px-3 py-1 text-sm",children:"Recusar"})]})]},e.id))})]}),(0,t.jsxs)("div",{className:"character-status p-4",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-4 text-japan-gold",children:"\uD83D\uDC65 Amigos"}),0===s.length?(0,t.jsx)("p",{className:"text-japan-cream opacity-60",children:"Nenhum amigo adicionado ainda"}):(0,t.jsx)("div",{className:"space-y-2",children:s.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-japan-black rounded",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e.is_online?"bg-green-500":"bg-gray-500")}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-japan-cream font-medium",children:e.username}),(0,t.jsx)("div",{className:"text-japan-cream opacity-60 text-sm",children:e.is_online?"Online":"Offline: ".concat(new Date(e.last_seen).toLocaleDateString())})]})]}),(0,t.jsx)("div",{className:"flex gap-2",children:e.is_online&&(0,t.jsx)("button",{onClick:()=>v(e.id),className:"japan-button px-3 py-1 text-sm",children:"\uD83C\uDF8C Convidar"})})]},e.id))})]})]})}function d(e){let{characterId:a}=e,[s,i]=(0,n.useState)(null),[c,o]=(0,n.useState)([]),[l,d]=(0,n.useState)(null),[m,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{x(),p()},[a]);let x=async()=>{let{data:e,error:s}=await r.from("characters").select("id, name, current_location, region").eq("id",a).single();e&&!s&&i(e),u(!1)},p=async()=>{let{data:e,error:a}=await r.from("map_locations").select("*").order("region",{ascending:!0});e&&!a&&o(e)},h=async e=>{if(!s||!e.is_accessible){alert("Localiza\xe7\xe3o n\xe3o acess\xedvel no momento");return}if(e.region!==s.region&&"musashi"!==e.region){alert("Voc\xea precisa desbloquear esta regi\xe3o primeiro");return}let{error:t}=await r.from("characters").update({current_location:e.name,region:e.region}).eq("id",a);t?alert("Erro ao viajar: "+t.message):(i(a=>a?{...a,current_location:e.name,region:e.region}:null),d(e),alert("Voc\xea viajou para ".concat(e.name,"!")))},j=e=>({owari:"#8B0000",kai:"#2F4F2F",shinano:"#4B0082",mino:"#DAA520",musashi:"#DC143C",echigo:"#4682B4"})[e]||"#666666";return m?(0,t.jsx)("div",{className:"text-japan-cream",children:"Carregando mapa..."}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"character-status p-6",children:[(0,t.jsx)("h3",{className:"text-2xl font-bold mb-4 text-japan-gold",children:"\uD83D\uDDFA️ Mapa do Jap\xe3o Sengoku"}),s&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-japan-black rounded",children:[(0,t.jsxs)("div",{className:"text-japan-cream",children:[(0,t.jsx)("span",{className:"font-bold",children:"\uD83D\uDCCD Posi\xe7\xe3o Atual:"})," ",s.current_location]}),(0,t.jsxs)("div",{className:"text-japan-cream opacity-60 text-sm",children:["Regi\xe3o: ",s.region]})]}),(0,t.jsx)("div",{className:"relative bg-japan-black rounded p-4",style:{minHeight:"400px"},children:(0,t.jsxs)("svg",{width:"100%",height:"400",viewBox:"0 0 800 600",className:"w-full",children:[c.map(e=>{let a=(null==s?void 0:s.current_location)===e.name,n=e.is_accessible;return(0,t.jsxs)("g",{children:[(0,t.jsx)("circle",{cx:e.x,cy:e.y,r:a?12:8,fill:j(e.region),stroke:a?"#FFD700":"#333",strokeWidth:a?3:1,className:"cursor-pointer transition-all hover:opacity-80",onClick:()=>n&&d(e)}),(0,t.jsx)("text",{x:e.x,y:e.y-15,textAnchor:"middle",fill:a?"#FFD700":"#F5F5DC",fontSize:"12",className:"pointer-events-none",children:e.name}),!n&&(0,t.jsx)("text",{x:e.x,y:e.y+20,textAnchor:"middle",fill:"#666",fontSize:"10",className:"pointer-events-none",children:"\uD83D\uDD12"})]},e.id)}),(0,t.jsx)("line",{x1:"400",y1:"300",x2:"200",y2:"200",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"}),(0,t.jsx)("line",{x1:"400",y1:"300",x2:"600",y2:"200",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"}),(0,t.jsx)("line",{x1:"400",y1:"300",x2:"300",y2:"400",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"}),(0,t.jsx)("line",{x1:"400",y1:"300",x2:"500",y2:"400",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"}),(0,t.jsx)("line",{x1:"400",y1:"300",x2:"400",y2:"500",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"})]})})]}),l&&(0,t.jsxs)("div",{className:"character-status p-4",children:[(0,t.jsx)("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:l.name}),(0,t.jsx)("p",{className:"text-japan-cream mb-3",children:l.description}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsxs)("span",{className:"text-japan-cream",children:["Regi\xe3o: ",l.region]}),(0,t.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:j(l.region)}})]}),(null==s?void 0:s.current_location)!==l.name&&(0,t.jsx)("button",{onClick:()=>h(l),disabled:!l.is_accessible,className:"japan-button w-full",children:l.is_accessible?"\uD83D\uDEB6 Viajar para este local":"\uD83D\uDD12 Localiza\xe7\xe3o bloqueada"}),(null==s?void 0:s.current_location)===l.name&&(0,t.jsx)("div",{className:"text-japan-gold text-center font-bold",children:"\uD83D\uDCCD Voc\xea est\xe1 aqui"})]}),(0,t.jsxs)("div",{className:"character-status p-4",children:[(0,t.jsx)("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:"\uD83D\uDCCD Localiza\xe7\xf5es"}),(0,t.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:c.map(e=>{let a=(null==s?void 0:s.current_location)===e.name;return(0,t.jsxs)("div",{className:"p-2 rounded cursor-pointer transition-all ".concat(a?"bg-japan-gold text-japan-black":"bg-japan-black text-japan-cream hover:bg-japan-red"),onClick:()=>d(e),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"font-medium",children:[e.name," ",a&&"\uD83D\uDCCD"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:j(e.region)}}),!e.is_accessible&&(0,t.jsx)("span",{children:"\uD83D\uDD12"})]})]}),(0,t.jsx)("div",{className:"text-sm opacity-70",children:e.region})]},e.id)})})]})]})}function m(e){let{onClick:a,children:s,className:n="",type:r="button",disabled:i=!1}=e;return(0,t.jsx)("button",{onClick:a,type:r,disabled:i,className:"japan-button ".concat(n),style:{cursor:i?"not-allowed":"pointer",opacity:i?.6:1,pointerEvents:"auto"},children:s})}async function u(e){var a,s,t,n,i;if(!e)return null;let{data:c}=await r.from("profiles").select("*").eq("id",e.id).single();if(c)return c;let{data:o,error:l}=await r.from("profiles").insert({id:e.id,username:(null===(a=e.user_metadata)||void 0===a?void 0:a.username)||(null===(s=e.email)||void 0===s?void 0:s.split("@")[0])||"user_"+e.id.slice(0,8),full_name:(null===(t=e.user_metadata)||void 0===t?void 0:t.full_name)||(null===(n=e.user_metadata)||void 0===n?void 0:n.username)||(null===(i=e.email)||void 0===i?void 0:i.split("@")[0])||"Usu\xe1rio"}).select().single();return l?(console.error("Erro ao criar perfil:",l),null):o}function x(){let[e,a]=(0,n.useState)(!1),[s,i]=(0,n.useState)(null),[c,x]=(0,n.useState)(!0),[p,h]=(0,n.useState)(""),[j,g]=(0,n.useState)("ferreiro"),[v,f]=(0,n.useState)("owari"),[b,N]=(0,n.useState)(""),[D,C]=(0,n.useState)(!1),[y,_]=(0,n.useState)(!1),[w,S]=(0,n.useState)(!1),[k,q]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{let{data:{user:e}}=await r.auth.getUser();i(e),e&&await u(e),x(!1)})();let{data:{subscription:e}}=r.auth.onAuthStateChange(async(e,a)=>{var s;i(null!==(s=null==a?void 0:a.user)&&void 0!==s?s:null),(null==a?void 0:a.user)&&await u(a.user)});return()=>e.unsubscribe()},[]);let E=async()=>{if(!s||!p.trim())return;await u(s);let{error:e}=await r.from("characters").insert({user_id:s.id,name:p,age:16,clan:v,profession:j,travel_reason:b,current_location:"Vila de origem",is_alive:!0,honor:50,created_at:new Date().toISOString()});e?alert("Erro ao criar personagem: "+e.message):(alert("Personagem criado com sucesso!"),h(""),g("ferreiro"),f("owari"),N(""),C(!0),a(!1))};return c?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-japan-cream",children:"Carregando..."})}):s?y?(0,t.jsx)("div",{className:"min-h-screen p-4",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsx)("div",{className:"japan-card p-6 mb-6",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-japan-red",children:"\uD83D\uDC65 Amigos"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("button",{onClick:()=>_(!1),className:"japan-button",children:"Voltar"}),(0,t.jsxs)("button",{onClick:()=>r.auth.signOut(),className:"text-sm text-japan-cream hover:text-japan-gold transition-colors",children:["Sair (",s.email,")"]})]})]})}),(0,t.jsx)(l,{userId:s.id})]})}):w&&k?(0,t.jsx)("div",{className:"min-h-screen p-4",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsx)("div",{className:"japan-card p-6 mb-6",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-japan-red",children:["\uD83D\uDDFA️ Mapa - ",k.name]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("button",{onClick:()=>S(!1),className:"japan-button",children:"Voltar"}),(0,t.jsxs)("button",{onClick:()=>r.auth.signOut(),className:"text-sm text-japan-cream hover:text-japan-gold transition-colors",children:["Sair (",s.email,")"]})]})]})}),(0,t.jsx)(d,{characterId:k.id})]})}):e?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,t.jsx)("div",{className:"max-w-2xl w-full",children:(0,t.jsxs)("div",{className:"japan-card p-8 bg-japan-black",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-center mb-8 text-japan-red",children:"Cr\xf4nicas do Jap\xe3o"}),(0,t.jsxs)("div",{className:"text-scene mb-8",children:[(0,t.jsx)("p",{className:"mb-4",children:"Ano de 1467. O Jap\xe3o est\xe1 mergulhado na Era Sengoku - o Per\xedodo dos Estados em Guerra. A vida cotidiana, o folclore e o sobrenatural se encontram em sil\xeancio."}),(0,t.jsxs)("p",{className:"mb-4",children:["Bem-vindo, ",(null==s?void 0:s.email)||"viajante","! Sua jornada est\xe1 prestes a come\xe7ar..."]})]}),(0,t.jsxs)("div",{className:"character-status",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4 text-japan-gold",children:"Cria\xe7\xe3o de Personagem"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nome:"}),(0,t.jsx)("input",{type:"text",value:p,onChange:e=>h(e.target.value),className:"w-full p-2 japan-input text-japan-cream",placeholder:"Digite seu nome..."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Origem (Prov\xedncia):"}),(0,t.jsxs)("select",{value:v,onChange:e=>f(e.target.value),className:"w-full p-2 japan-input text-japan-cream",children:[(0,t.jsx)("option",{value:"owari",children:"Owari - Plan\xedcies Centrais"}),(0,t.jsx)("option",{value:"kai",children:"Kai - Montanhas"}),(0,t.jsx)("option",{value:"shinano",children:"Shinano - Interior"}),(0,t.jsx)("option",{value:"mino",children:"Mino - Vale"}),(0,t.jsx)("option",{value:"musashi",children:"Musashi - Capital"}),(0,t.jsx)("option",{value:"echigo",children:"Echigo - Norte"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Profiss\xe3o:"}),(0,t.jsxs)("select",{value:j,onChange:e=>g(e.target.value),className:"w-full p-2 japan-input text-japan-cream",children:[(0,t.jsx)("option",{value:"ferreiro",children:"Ferreiro"}),(0,t.jsx)("option",{value:"campones",children:"Campon\xeas"}),(0,t.jsx)("option",{value:"mensageiro",children:"Mensageiro"}),(0,t.jsx)("option",{value:"monge",children:"Monge novi\xe7o"}),(0,t.jsx)("option",{value:"ronin",children:"Ronin"}),(0,t.jsx)("option",{value:"artesao",children:"Artes\xe3o"}),(0,t.jsx)("option",{value:"comerciante",children:"Comerciante"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Motivo da viagem / mudan\xe7a:"}),(0,t.jsx)("textarea",{value:p,onChange:e=>h(e.target.value),className:"w-full p-2 japan-input text-japan-cream",placeholder:"Ex: Perdi a oficina em um inc\xeandio e precisei me mudar...",rows:3})]}),(0,t.jsxs)("div",{className:"text-sm text-japan-cream opacity-70",children:[(0,t.jsxs)("p",{className:"mb-2",children:["\uD83D\uDCDD ",(0,t.jsx)("strong",{children:"Seu personagem \xe9 um humano comum"}),", sem poderes especiais ou destino \xe9pico."]}),(0,t.jsxs)("p",{className:"mb-2",children:["\uD83C\uDFAD ",(0,t.jsx)("strong",{children:"Seus atributos ser\xe3o definidos por suas escolhas"})," durante o question\xe1rio narrativo."]}),(0,t.jsxs)("p",{children:["⚔️ ",(0,t.jsx)("strong",{children:"Combate \xe9 raro e perigoso"})," - fugir sempre \xe9 uma op\xe7\xe3o v\xe1lida."]})]}),(0,t.jsx)("button",{onClick:E,className:"japan-button w-full",children:"Criar Personagem"})]})]})]})})}):D?(0,t.jsx)("div",{className:"min-h-screen p-4",children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,t.jsx)("div",{className:"japan-card p-6 mb-6",children:(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-japan-red",children:"Cr\xf4nicas do Jap\xe3o"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)("button",{onClick:()=>_(!0),className:"japan-button",children:"\uD83D\uDC65 Amigos"}),(0,t.jsx)("button",{onClick:()=>C(!1),className:"japan-button",children:"Novo Personagem"}),(0,t.jsxs)("button",{onClick:()=>r.auth.signOut(),className:"text-sm text-japan-cream hover:text-japan-gold transition-colors",children:["Sair (",s.email,")"]})]})]})}),(0,t.jsx)(o,{userId:s.id,onSelectCharacter:e=>{q(e),S(!0)}})]})}):void 0:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:(0,t.jsx)("div",{className:"max-w-5xl w-full relative z-10",children:(0,t.jsxs)("div",{className:"japan-card p-12 text-center",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-6xl font-bold mb-4 japan-title",children:"\uD83C\uDFEF Cr\xf4nicas do Jap\xe3o"}),(0,t.jsx)("div",{className:"samurai-divider"})]}),(0,t.jsxs)("div",{className:"text-scene mb-16 max-w-4xl mx-auto",children:[(0,t.jsx)("h2",{className:"text-4xl font-bold mb-8 text-japan-gold",children:"\uD83C\uDF11 Um Jap\xe3o esquecido observa voc\xea."}),(0,t.jsx)("p",{className:"text-xl mb-6 leading-relaxed",children:"Nem todos os horrores vivem nos contos. Alguns caminham pelas estradas, se escondem nos templos e observam aqueles que ainda n\xe3o despertaram."}),(0,t.jsx)("p",{className:"text-xl mb-6 leading-relaxed",children:"Cr\xf4nicas do Jap\xe3o \xe9 um RPG narrativo ambientado no per\xedodo Sengoku, onde a vida cotidiana, o folclore e o sobrenatural se encontram em sil\xeancio."}),(0,t.jsx)("p",{className:"text-xl mb-8 leading-relaxed",children:"Voc\xea come\xe7a como uma pessoa comum — campon\xeas, mercador, monge, soldado — sem saber que o mundo guarda algo al\xe9m do vis\xedvel. Conforme sua hist\xf3ria se desenvolve, suas escolhas moldam seu corpo, sua mente e sua percep\xe7\xe3o do oculto… at\xe9 o dia em que voc\xea n\xe3o pode mais fingir que n\xe3o v\xea."}),(0,t.jsx)("p",{className:"text-2xl font-bold text-japan-gold",children:"⚔️ Escreva sua hist\xf3ria. Viva. Desperte."})]}),(0,t.jsxs)("div",{className:"character-status p-8 mb-16",children:[(0,t.jsx)("h3",{className:"text-2xl font-bold mb-6 text-japan-red",children:"\uD83D\uDD6F️ O Que Aguarda"}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:"\uD83E\uDDED Evolu\xe7\xe3o Silenciosa"}),(0,t.jsx)("p",{className:"text-base leading-relaxed text-japan-cream",children:"Nada acontece de uma vez. Cada decis\xe3o, rotina ou erro molda seu corpo, sua mente e aquilo que voc\xea ser\xe1 capaz de perceber."})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:"\uD83D\uDC64 Vidas Comuns"}),(0,t.jsx)("p",{className:"text-base leading-relaxed text-japan-cream",children:"Voc\xea come\xe7a invis\xedvel para o mundo. Um rosto entre muitos. Nenhum destino escrito. Nenhuma prote\xe7\xe3o divina."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:"⏳ O Peso do Tempo"}),(0,t.jsx)("p",{className:"text-base leading-relaxed text-japan-cream",children:"Os anos passam. O corpo muda. Rela\xe7\xf5es surgem e se desfazem. Voc\xea pode deixar filhos, hist\xf3rias... ou marcas que nunca desaparecem."})]})]}),(0,t.jsxs)("div",{className:"space-y-6 max-w-md mx-auto",children:[(0,t.jsx)(m,{onClick:()=>{console.log("Bot\xe3o Entrar clicado"),a(!0)},className:"text-2xl px-16 py-8 w-full font-bold",children:"\uD83D\uDEAA Entrar"}),(0,t.jsx)("div",{className:"samurai-divider"}),(0,t.jsx)("div",{className:"text-base text-japan-cream opacity-80",children:"\uD83C\uDF8C Sistema de RPG de Vida • Jap\xe3o Sengoku • Progress\xe3o Org\xe2nica"}),(0,t.jsx)("div",{className:"text-sm text-japan-cream opacity-60",children:'\uD83C\uDF1F "O mundo n\xe3o gira ao seu redor"'})]})]})})})}i.SEASONS=["spring","summer","autumn","winter"],i.SEASON_NAMES={spring:"Primavera",summer:"Ver\xe3o",autumn:"Outono",winter:"Inverno"}}},function(e){e.O(0,[311,971,938,744],function(){return e(e.s=7678)}),_N_E=e.O()}]);