(()=>{var e={};e.id=931,e.ids=[931],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},5578:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>d,originalPathname:()=>u,pages:()=>h,routeModule:()=>p,tree:()=>c});var r=s(482),a=s(9108),i=s(2563),n=s.n(i),o=s(8300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,751)),"C:\\Users\\hvgau.LAPTOP-7C6COKFO\\Documents\\projetos\\cronicas-do-japao\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,2917)),"C:\\Users\\hvgau.LAPTOP-7C6COKFO\\Documents\\projetos\\cronicas-do-japao\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"]}],h=["C:\\Users\\hvgau.LAPTOP-7C6COKFO\\Documents\\projetos\\cronicas-do-japao\\app\\page.tsx"],u="/page",d={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},339:(e,t,s)=>{Promise.resolve().then(s.bind(s,6584))},3073:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2583,23)),Promise.resolve().then(s.t.bind(s,6840,23)),Promise.resolve().then(s.t.bind(s,8771,23)),Promise.resolve().then(s.t.bind(s,3225,23)),Promise.resolve().then(s.t.bind(s,9295,23)),Promise.resolve().then(s.t.bind(s,3982,23))},8610:()=>{},6584:(e,t,s)=>{"use strict";let r;s.r(t),s.d(t,{default:()=>s$});var a,i,n,o,l,c,h,u,d,p,f,m=s(2295),g=s(3729);function y(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)0>t.indexOf(r[a])&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]]);return s}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;let w=e=>e?(...t)=>e(...t):(...e)=>fetch(...e);class b extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class v extends b{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class _ extends b{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class x extends b{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(a||(a={}));class j{constructor(e,{headers:t={},customFetch:s,region:r=a.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=w(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){var t,s,r,a;return t=this,s=arguments,r=void 0,a=function*(e,t={}){var s;let r,a;try{let i;let{headers:n,method:o,body:l,signal:c,timeout:h}=t,u={},{region:d}=t;d||(d=this.region);let p=new URL(`${this.url}/${e}`);d&&"any"!==d&&(u["x-region"]=d,p.searchParams.set("forceFunctionRegion",d)),l&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)?"undefined"!=typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",i=l):"string"==typeof l?(u["Content-Type"]="text/plain",i=l):"undefined"!=typeof FormData&&l instanceof FormData?i=l:(u["Content-Type"]="application/json",i=JSON.stringify(l)):i=!l||"string"==typeof l||"undefined"!=typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer||"undefined"!=typeof FormData&&l instanceof FormData?l:JSON.stringify(l);let f=c;h&&(a=new AbortController,r=setTimeout(()=>a.abort(),h),c?(f=a.signal,c.addEventListener("abort",()=>a.abort())):f=a.signal);let m=yield this.fetch(p.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),n),body:i,signal:f}).catch(e=>{throw new v(e)}),g=m.headers.get("x-relay-error");if(g&&"true"===g)throw new _(m);if(!m.ok)throw new x(m);let y=(null!==(s=m.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return{data:"application/json"===y?yield m.json():"application/octet-stream"===y||"application/pdf"===y?yield m.blob():"text/event-stream"===y?m:"multipart/form-data"===y?yield m.formData():yield m.text(),error:null,response:m}}catch(e){return{data:null,error:e,response:e instanceof x||e instanceof _?e.context:void 0}}finally{r&&clearTimeout(r)}},new(r||(r=Promise))(function(e,i){function n(e){try{l(a.next(e))}catch(e){i(e)}}function o(e){try{l(a.throw(e))}catch(e){i(e)}}function l(t){var s;t.done?e(t.value):((s=t.value)instanceof r?s:new r(function(e){e(s)})).then(n,o)}l((a=a.apply(t,s||[])).next())})}}var k=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},S=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var s=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,a,i;let n=null,o=null,l=null,c=e.status,h=e.statusText;if(e.ok){if("HEAD"!==s.method){let t=await e.text();""===t||(o="text/csv"===s.headers.get("Accept")?t:s.headers.get("Accept")&&(null===(a=s.headers.get("Accept"))||void 0===a?void 0:a.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}let i=null===(t=s.headers.get("Prefer"))||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),u=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");i&&u&&u.length>1&&(l=parseInt(u[1])),s.isMaybeSingle&&"GET"===s.method&&Array.isArray(o)&&(o.length>1?(n={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,c=406,h="Not Acceptable"):o=1===o.length?o[0]:null)}else{let t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(o=[],n=null,c=200,h="OK")}catch(s){404===e.status&&""===t?(c=204,h="No Content"):n={message:t}}if(n&&s.isMaybeSingle&&(null==n||null===(i=n.details)||void 0===i?void 0:i.includes("0 rows"))&&(n=null,c=200,h="OK"),n&&s.shouldThrowOnError)throw new k(n)}return{error:n,data:o,count:l,status:c,statusText:h}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,s,r,a,i,n;let o="",l=null==e?void 0:e.cause;if(l){let t=null!==(s=null==l?void 0:l.message)&&void 0!==s?s:"",n=null!==(r=null==l?void 0:l.code)&&void 0!==r?r:"";o=`${null!==(a=null==e?void 0:e.name)&&void 0!==a?a:"FetchError"}: ${null==e?void 0:e.message}

Caused by: ${null!==(i=null==l?void 0:l.name)&&void 0!==i?i:"Error"}: ${t}`,n&&(o+=` (${n})`),(null==l?void 0:l.stack)&&(o+=`
${l.stack}`)}else o=null!==(n=null==e?void 0:e.stack)&&void 0!==n?n:"";return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}},E=class extends S{select(e){let t=!1,s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:a=r}={}){let i=a?`${a}.order`:"order",n=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){let r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){let a=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:a=!1,format:i="text"}={}){var n;let o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=null!==(n=this.headers.get("Accept"))&&void 0!==n?n:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};let T=RegExp("[,()]");var O=class extends E{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){let s=Array.from(new Set(t)).map(e=>"string"==typeof e&&T.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}notIn(e,t){let s=Array.from(new Set(t)).map(e=>"string"==typeof e&&T.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`not.in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let a="";"plain"===r?a="pl":"phrase"===r?a="ph":"websearch"===r&&(a="w");let i=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${a}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){let r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}},R=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=r}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){let{head:s=!1,count:r}=null!=t?t:{},a=!1,i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!a?"":('"'===e&&(a=!a),e)).join(""),{url:n,headers:o}=this.cloneRequestState();return n.searchParams.set("select",i),r&&o.append("Prefer",`count=${r}`),new O({method:s?"HEAD":"GET",url:n,headers:o,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var r;let{url:a,headers:i}=this.cloneRequestState();if(t&&i.append("Prefer",`count=${t}`),s||i.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);a.searchParams.set("columns",e.join(","))}}return new O({method:"POST",url:a,headers:i,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:a=!0}={}){var i;let{url:n,headers:o}=this.cloneRequestState();if(o.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),void 0!==t&&n.searchParams.set("on_conflict",t),r&&o.append("Prefer",`count=${r}`),a||o.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);n.searchParams.set("columns",e.join(","))}}return new O({method:"POST",url:n,headers:o,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(e,{count:t}={}){var s;let{url:r,headers:a}=this.cloneRequestState();return t&&a.append("Prefer",`count=${t}`),new O({method:"PATCH",url:r,headers:a,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}delete({count:e}={}){var t;let{url:s,headers:r}=this.cloneRequestState();return e&&r.append("Prefer",`count=${e}`),new O({method:"DELETE",url:s,headers:r,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}},A=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=r}from(e){if(!e||"string"!=typeof e||""===e.trim())throw Error("Invalid relation name: relation must be a non-empty string.");return new R(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:a}={}){var i;let n,o;let l=new URL(`${this.url}/rpc/${e}`),c=e=>null!==e&&"object"==typeof e&&(!Array.isArray(e)||e.some(c)),h=s&&Object.values(t).some(c);h?(n="POST",o=t):s||r?(n=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(n="POST",o=t);let u=new Headers(this.headers);return h?u.set("Prefer",a?`count=${a},return=minimal`:"return=minimal"):a&&u.set("Prefer",`count=${a}`),new O({method:n,url:l,headers:u,schema:this.schemaName,body:o,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}};class N{constructor(){}static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};let t=globalThis.process;if(t){let e=t.versions;if(e&&e.node){let t=parseInt(e.node.replace(/^v/,"").split(".")[0]);return t>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}let C="1.0.0";(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(i||(i={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(n||(n={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(o||(o={})),(l||(l={})).websocket="websocket",function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(c||(c={}));class ${constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){return e.event!==this.BROADCAST_EVENT||e.payload instanceof ArrayBuffer||"string"!=typeof e.payload.event?t(JSON.stringify([e.join_ref,e.ref,e.topic,e.event,e.payload])):t(this._binaryEncodeUserBroadcastPush(e))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,s;let r=null!==(s=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==s?s:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var t,s;let r=null!==(s=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==s?s:{},a=new TextEncoder().encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(e,t,s){let r=e.topic,a=null!==(p=e.ref)&&void 0!==p?p:"",i=null!==(f=e.join_ref)&&void 0!==f?f:"",n=e.payload.event,o=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},l=0===Object.keys(o).length?"":JSON.stringify(o);if(i.length>255)throw Error(`joinRef length ${i.length} exceeds maximum of 255`);if(a.length>255)throw Error(`ref length ${a.length} exceeds maximum of 255`);if(r.length>255)throw Error(`topic length ${r.length} exceeds maximum of 255`);if(n.length>255)throw Error(`userEvent length ${n.length} exceeds maximum of 255`);if(l.length>255)throw Error(`metadata length ${l.length} exceeds maximum of 255`);let c=this.USER_BROADCAST_PUSH_META_LENGTH+i.length+a.length+r.length+n.length+l.length,h=new ArrayBuffer(this.HEADER_LENGTH+c),u=new DataView(h),d=0;u.setUint8(d++,this.KINDS.userBroadcastPush),u.setUint8(d++,i.length),u.setUint8(d++,a.length),u.setUint8(d++,r.length),u.setUint8(d++,n.length),u.setUint8(d++,l.length),u.setUint8(d++,t),Array.from(i,e=>u.setUint8(d++,e.charCodeAt(0))),Array.from(a,e=>u.setUint8(d++,e.charCodeAt(0))),Array.from(r,e=>u.setUint8(d++,e.charCodeAt(0))),Array.from(n,e=>u.setUint8(d++,e.charCodeAt(0))),Array.from(l,e=>u.setUint8(d++,e.charCodeAt(0)));var p,f,m=new Uint8Array(h.byteLength+s.byteLength);return m.set(new Uint8Array(h),0),m.set(new Uint8Array(s),h.byteLength),m.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){let[s,r,a,i,n]=JSON.parse(e);return t({join_ref:s,ref:r,topic:a,event:i,payload:n})}return t({})}_binaryDecode(e){let t=new DataView(e),s=t.getUint8(0),r=new TextDecoder;if(s===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,r)}_decodeUserBroadcast(e,t,s){let r=t.getUint8(1),a=t.getUint8(2),i=t.getUint8(3),n=t.getUint8(4),o=this.HEADER_LENGTH+4,l=s.decode(e.slice(o,o+r));o+=r;let c=s.decode(e.slice(o,o+a));o+=a;let h=s.decode(e.slice(o,o+i));o+=i;let u=e.slice(o,e.byteLength),d=n===this.JSON_ENCODING?JSON.parse(s.decode(u)):u,p={type:this.BROADCAST_EVENT,event:c,payload:d};return i>0&&(p.meta=JSON.parse(h)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class P{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(h||(h={}));let I=(e,t,s={})=>{var r;let a=null!==(r=s.skipTypes)&&void 0!==r?r:[];return t?Object.keys(t).reduce((s,r)=>(s[r]=D(r,e,t,a),s),{}):{}},D=(e,t,s,r)=>{let a=t.find(t=>t.name===e),i=null==a?void 0:a.type,n=s[e];return i&&!r.includes(i)?U(i,n):q(n)},U=(e,t)=>{if("_"===e.charAt(0))return M(t,e.slice(1,e.length));switch(e){case h.bool:return L(t);case h.float4:case h.float8:case h.int2:case h.int4:case h.int8:case h.numeric:case h.oid:return B(t);case h.json:case h.jsonb:return V(t);case h.timestamp:return K(t);case h.abstime:case h.date:case h.daterange:case h.int4range:case h.int8range:case h.money:case h.reltime:case h.text:case h.time:case h.timestamptz:case h.timetz:case h.tsrange:case h.tstzrange:default:return q(t)}},q=e=>e,L=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},B=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},V=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},M=(e,t)=>{if("string"!=typeof e)return e;let s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;let a=e.slice(1,s);try{r=JSON.parse("["+a+"]")}catch(e){r=a?a.split(","):[]}return r.map(e=>U(t,e))}return e},K=e=>"string"==typeof e?e.replace(" ","T"):e,F=e=>{let t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class W{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(u||(u={}));class J{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{let{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=J.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=J.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{let{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=J.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){let a=this.cloneDeep(e),i=this.transformState(t),n={},o={};return this.map(a,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{let s=a[e];if(s){let r=t.map(e=>e.presence_ref),a=s.map(e=>e.presence_ref),i=t.filter(e=>0>a.indexOf(e.presence_ref)),l=s.filter(e=>0>r.indexOf(e.presence_ref));i.length>0&&(n[e]=i),l.length>0&&(o[e]=l)}else n[e]=t}),this.syncDiff(a,{joins:n,leaves:o},s,r)}static syncDiff(e,t,s,r){let{joins:a,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(a,(t,r)=>{var a;let i=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=this.cloneDeep(r),i.length>0){let s=e[t].map(e=>e.presence_ref),r=i.filter(e=>0>s.indexOf(e.presence_ref));e[t].unshift(...r)}s(t,i,r)}),this.map(i,(t,s)=>{let a=e[t];if(!a)return;let i=s.map(e=>e.presence_ref);a=a.filter(e=>0>i.indexOf(e.presence_ref)),e[t]=a,r(t,a,s),0===a.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,s)=>{let r=e[s];return"metas"in r?t[s]=r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(d||(d={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(p||(p={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(f||(f={}));class z{constructor(e,t={config:{}},s){var r,a;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=n.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new W(this,o.join,this.params,this.timeout),this.rejoinTimer=new P(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=n.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=n.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=n.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=n.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=n.errored,this.rejoinTimer.scheduleTimeout())}),this._on(o.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new J(this),this.broadcastEndpointURL=F(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(a=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===a?void 0:a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,r,a;if(this.socket.isConnected()||this.socket.connect(),this.state==n.closed){let{config:{broadcast:i,presence:o,private:l}}=this.params,c=null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],h=!!this.bindings[p.PRESENCE]&&this.bindings[p.PRESENCE].length>0||(null===(a=this.params.config.presence)||void 0===a?void 0:a.enabled)===!0,u={},d={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:h}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(f.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(f.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket._isManualToken()||this.socket.setAuth(),void 0===t){null==e||e(f.SUBSCRIBED);return}{let r=this.bindings.postgres_changes,a=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,i=[];for(let s=0;s<a;s++){let a=r[s],{filter:{event:o,schema:l,table:c,filter:h}}=a,u=t&&t[s];if(u&&u.event===o&&z.isFilterValueEqual(u.schema,l)&&z.isFilterValueEqual(u.table,c)&&z.isFilterValueEqual(u.filter,h))i.push(Object.assign(Object.assign({},a),{id:u.id}));else{this.unsubscribe(),this.state=n.errored,null==e||e(f.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=i,e&&e(f.SUBSCRIBED);return}}).receive("error",t=>{this.state=n.errored,null==e||e(f.CHANNEL_ERROR,Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(f.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===n.joined&&e===p.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,s)}async httpSend(e,t,s={}){var r;if(null==t)return Promise.reject("Payload is required for httpSend()");let a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);let i={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},n=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(r=s.timeout)&&void 0!==r?r:this.timeout);if(202===n.status)return{success:!0};let o=n.statusText;try{let e=await n.json();o=e.error||e.message||o}catch(e){}return Promise.reject(Error(o))}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,a,i;let n=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(a=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===a?void 0:a.broadcast)||void 0===i?void 0:i.ack)||s("ok"),n.receive("ok",()=>s("ok")),n.receive("error",()=>s("error")),n.receive("timeout",()=>s("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:a,payload:i}=e,n={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(n.Authorization=`Bearer ${this.socket.accessTokenValue}`);let o={method:"POST",headers:n,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i,private:this.private}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await (null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=n.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(o.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{(s=new W(this,o.leave,{},e)).receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=n.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){let r=new AbortController,a=setTimeout(()=>r.abort(),s),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(a),i}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new W(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){let e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,a;let i=e.toLocaleLowerCase(),{close:n,error:l,leave:c,join:h}=o;if(s&&[n,l,c,h].indexOf(i)>=0&&s!==this._joinRef())return;let u=this._onMessage(i,t,s);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return(null===(t=e.filter)||void 0===t?void 0:t.event)==="*"||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===i}).map(e=>e.callback(u,s)):null===(a=this.bindings[i])||void 0===a||a.filter(e=>{var s,r,a,n,o,l,c,h;if(!["broadcast","presence","postgres_changes"].includes(i))return e.type.toLocaleLowerCase()===i;if("id"in e){let i=e.id,l=null===(s=e.filter)||void 0===s?void 0:s.event;return i&&(null===(r=t.ids)||void 0===r?void 0:r.includes(i))&&("*"===l||(null==l?void 0:l.toLocaleLowerCase())===(null===(a=t.data)||void 0===a?void 0:a.type.toLocaleLowerCase()))&&(!(null===(n=e.filter)||void 0===n?void 0:n.table)||e.filter.table===(null===(o=t.data)||void 0===o?void 0:o.table))}{let s=null===(c=null===(l=null==e?void 0:e.filter)||void 0===l?void 0:l.event)||void 0===c?void 0:c.toLocaleLowerCase();return"*"===s||s===(null===(h=null==t?void 0:t.event)||void 0===h?void 0:h.toLocaleLowerCase())}}).map(e=>{if("object"==typeof u&&"ids"in u){let e=u.data,{schema:t,table:s,commit_timestamp:r,type:a,errors:i}=e;u=Object.assign(Object.assign({},{schema:t,table:s,commit_timestamp:r,eventType:a,new:{},old:{},errors:i}),this._getPayloadRecords(e))}e.callback(u,s)})}_isClosed(){return this.state===n.closed}_isJoined(){return this.state===n.joined}_isJoining(){return this.state===n.joining}_isLeaving(){return this.state===n.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){let r=e.toLocaleLowerCase(),a={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(a):this.bindings[r]=[a],this}_off(e,t){let s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&z.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let s in e)if(e[s]!==t[s])return!1;return!0}static isFilterValueEqual(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(o.close,{},e)}_onError(e){this._on(o.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=n.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=I(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=I(e.columns,e.old_record)),t}}let G=()=>{},H={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Y=[1e3,2e3,5e3,1e4],X=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Q{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=H.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=G,this.ref=0,this.reconnectTimer=null,this.vsn=C,this.logger=G,this.conn=null,this.sendBuffer=[],this.serializer=new $,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${l.websocket}`,this.httpEndpoint=F(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=N.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");let e=t.message;if(e.includes("Node.js"))throw Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`);throw Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting()){if(this._setConnectionState("disconnecting",!0),this.conn){let s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case i.connecting:return c.Connecting;case i.open:return c.Open;case i.closing:return c.Closing;default:return c.Closed}}isConnected(){return this.connectionState()===c.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){let s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{let s=new z(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){let{topic:t,event:s,payload:r,ref:a}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${a})`,r),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},H.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===this.pendingHeartbeatRef){let t=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error",t)}catch(e){this.log("error","error in heartbeat callback",e)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}let{topic:t,event:s,payload:r,ref:a}=e,i=a?`(${a})`:"",n=r.status||"";this.log("receive",`${n} ${t} ${s} ${i}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,a)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===i.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===i.open||this.conn.readyState===i.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(o.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{let e=new Blob([X],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;let s=!1;if(e)t=e,s=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(e){this.log("error","Error fetching access token from callback",e),t=this.accessTokenValue}else t=this.accessTokenValue;s?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{let s={access_token:t,version:"realtime-js/2.90.1"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(o.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new P(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},H.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,a,i,n,o,l,c,h,u,d;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:1e4,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:H.HEARTBEAT_INTERVAL,this.worker=null!==(a=null==e?void 0:e.worker)&&void 0!==a&&a,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(n=null==e?void 0:e.heartbeatCallback)&&void 0!==n?n:G,this.vsn=null!==(o=null==e?void 0:e.vsn)&&void 0!==o?o:C,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null==e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>Y[e-1]||1e4,this.vsn){case C:this.encode=null!==(c=null==e?void 0:e.encode)&&void 0!==c?c:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(h=null==e?void 0:e.decode)&&void 0!==h?h:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!==(u=null==e?void 0:e.encode)&&void 0!==u?u:this.serializer.encode.bind(this.serializer),this.decode=null!==(d=null==e?void 0:e.decode)&&void 0!==d?d:this.serializer.decode.bind(this.serializer);break;default:throw Error(`Unsupported serializer version: ${this.vsn}`)}this.worker&&(this.workerUrl=null==e?void 0:e.workerUrl)}}var Z=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===!0}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};async function ee(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}function et(e){return e.join("\x1f")}var es=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){let t=e?{parent:et(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){let s={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:s})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${et(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${et(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${et(e.namespace)}`}),!0}catch(e){if(e instanceof Z&&404===e.status)return!1;throw e}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(e){if(e instanceof Z&&409===e.status)return;throw e}}};function er(e){return e.join("\x1f")}var ea=class{constructor(e,t="",s){this.client=e,this.prefix=t,this.accessDelegation=s}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${er(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){let s={};return this.accessDelegation&&(s["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${er(e.namespace)}/tables`,body:t,headers:s})).data.metadata}async updateTable(e,t){let s=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${er(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":s.data["metadata-location"],metadata:s.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${er(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){let t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${er(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){let t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${er(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(e){if(e instanceof Z&&404===e.status)return!1;throw e}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(s){if(s instanceof Z&&409===s.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw s}}},ei=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);let s=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=function(e){let t=e.fetchImpl??globalThis.fetch;return{async request({method:s,path:r,query:a,body:i,headers:n}){let o=function(e,t,s){let r=new URL(t,e);if(s)for(let[e,t]of Object.entries(s))void 0!==t&&r.searchParams.set(e,t);return r.toString()}(e.baseUrl,r,a),l=await ee(e.auth),c=await t(o,{method:s,headers:{...i?{"Content-Type":"application/json"}:{},...l,...n},body:i?JSON.stringify(i):void 0}),h=await c.text(),u=(c.headers.get("content-type")||"").includes("application/json"),d=u&&h?JSON.parse(h):h;if(!c.ok){let e=u?d:void 0,t=e?.error;throw new Z(t?.message??`Request failed with status ${c.status}`,{status:c.status,icebergType:t?.type,icebergCode:t?.code,details:e})}return{status:c.status,headers:c.headers,data:d}}}}({baseUrl:s,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new es(this.client,t),this.tableOps=new ea(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},en=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function eo(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}var el=class extends en{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ec=class extends en{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};let eh=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),eu=()=>Response,ed=e=>{if(Array.isArray(e))return e.map(e=>ed(e));if("function"==typeof e||e!==Object(e))return e;let t={};return Object.entries(e).forEach(([e,s])=>{t[e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""))]=ed(s)}),t},ep=e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},ef=e=>!(!e||"string"!=typeof e||0===e.length||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\"))&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function em(e){return(em="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eg(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,r)}return s}function ey(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?eg(Object(s),!0).forEach(function(t){!function(e,t,s){var r;(r=function(e,t){if("object"!=em(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=em(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==em(r)?r:r+"")in e)?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s}(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):eg(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let ew=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},eb=async(e,t,s)=>{e instanceof await eu()&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{let r=e.status||500,a=(null==s?void 0:s.statusCode)||r+"";t(new el(ew(s),r,a))}).catch(e=>{t(new ec(ew(e),e))}):t(new ec(ew(e),e))},ev=(e,t,s,r)=>{let a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?(ep(r)?(a.headers=ey({"Content-Type":"application/json"},null==t?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,(null==t?void 0:t.duplex)&&(a.duplex=t.duplex),ey(ey({},a),s)):a};async function e_(e,t,s,r,a,i){return new Promise((n,o)=>{e(s,ev(t,r,a,i)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>n(e)).catch(e=>eb(e,o,r))})}async function ex(e,t,s,r){return e_(e,"GET",t,s,r)}async function ej(e,t,s,r,a){return e_(e,"POST",t,r,a,s)}async function ek(e,t,s,r,a){return e_(e,"PUT",t,r,a,s)}async function eS(e,t,s,r){return e_(e,"HEAD",t,ey(ey({},s),{},{noResolveJson:!0}),r)}async function eE(e,t,s,r,a){return e_(e,"DELETE",t,r,a,s)}var eT=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}};r=Symbol.toStringTag;var eO=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[r]="BlobDownloadBuilder",this.promise=null}asStream(){return new eT(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await (await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}};let eR={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eA={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var eN=class{constructor(e,t={},s,r){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=eh(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,s,r){try{let a;let i=ey(ey({},eA),r),n=ey(ey({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)}),o=i.metadata;"undefined"!=typeof Blob&&s instanceof Blob?((a=new FormData).append("cacheControl",i.cacheControl),o&&a.append("metadata",this.encodeMetadata(o)),a.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?((a=s).has("cacheControl")||a.append("cacheControl",i.cacheControl),o&&!a.has("metadata")&&a.append("metadata",this.encodeMetadata(o))):(a=s,n["cache-control"]=`max-age=${i.cacheControl}`,n["content-type"]=i.contentType,o&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(o))),("undefined"!=typeof ReadableStream&&a instanceof ReadableStream||a&&"object"==typeof a&&"pipe"in a&&"function"==typeof a.pipe)&&!i.duplex&&(i.duplex="half")),(null==r?void 0:r.headers)&&(n=ey(ey({},n),r.headers));let l=this._removeEmptyFolders(t),c=this._getFinalPath(l),h=await ("PUT"==e?ek:ej)(this.fetch,`${this.url}/object/${c}`,a,ey({headers:n},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:h.Id,fullPath:h.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async upload(e,t,s){return this.uploadOrUpdate("POST",e,t,s)}async uploadToSignedUrl(e,t,s,r){let a=this._removeEmptyFolders(e),i=this._getFinalPath(a),n=new URL(this.url+`/object/upload/sign/${i}`);n.searchParams.set("token",t);try{let e;let t=ey({upsert:eA.upsert},r),i=ey(ey({},this.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&s instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s).append("cacheControl",t.cacheControl):(e=s,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType),{data:{path:a,fullPath:(await ek(this.fetch,n.toString(),e,{headers:i})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async createSignedUploadUrl(e,t){try{let s=this._getFinalPath(e),r=ey({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");let a=await ej(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),i=new URL(this.url+a.url),n=i.searchParams.get("token");if(!n)throw new en("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:n},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async update(e,t,s){return this.uploadOrUpdate("PUT",e,t,s)}async move(e,t,s){try{return{data:await ej(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async copy(e,t,s){try{return{data:{path:(await ej(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async createSignedUrl(e,t,s){try{let r=this._getFinalPath(e),a=await ej(this.fetch,`${this.url}/object/sign/${r}`,ey({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers}),i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:a={signedUrl:encodeURI(`${this.url}${a.signedURL}${i}`)},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async createSignedUrls(e,t,s){var r=this;try{let a=await ej(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:t,paths:e},{headers:r.headers}),i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:a.map(e=>ey(ey({},e),{},{signedUrl:e.signedURL?encodeURI(`${r.url}${e.signedURL}${i}`):null})),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}download(e,t){let s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),a=r?`?${r}`:"",i=this._getFinalPath(e);return new eO(()=>ex(this.fetch,`${this.url}/${s}/${i}${a}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(e){let t=this._getFinalPath(e);try{return{data:ed(await ex(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers})),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async exists(e){let t=this._getFinalPath(e);try{return await eS(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e)&&e instanceof ec){let t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}getPublicUrl(e,t){let s=this._getFinalPath(e),r=[],a=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==a&&r.push(a);let i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==n&&r.push(n);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${s}${o}`)}}}async remove(e){try{return{data:await eE(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async list(e,t,s){try{let r=ey(ey(ey({},eR),t),{},{prefix:e||""});return{data:await ej(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async listV2(e,t){try{let s=ey({},e);return{data:await ej(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};let eC="2.90.1",e$={"X-Client-Info":`storage-js/${eC}`};var eP=class{constructor(e,t={},s,r){this.shouldThrowOnError=!1;let a=new URL(e);(null==r?void 0:r.useNewHostname)&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=ey(ey({},e$),t),this.fetch=eh(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){try{let t=this.listBucketOptionsToQueryString(e);return{data:await ex(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async getBucket(e){try{return{data:await ex(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async createBucket(e,t={public:!1}){try{return{data:await ej(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async updateBucket(e,t){try{return{data:await ek(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async emptyBucket(e){try{return{data:await ej(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async deleteBucket(e){try{return{data:await eE(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}listBucketOptionsToQueryString(e){let t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},eI=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=ey(ey({},e$),t),this.fetch=eh(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){try{return{data:await ej(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async listBuckets(e){try{let t=new URLSearchParams;(null==e?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(null==e?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&t.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&t.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&t.set("search",e.search);let s=t.toString(),r=s?`${this.url}/bucket?${s}`:`${this.url}/bucket`;return{data:await ex(this.fetch,r,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}async deleteBucket(e){try{return{data:await eE(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eo(e))return{data:null,error:e};throw e}}from(e){var t=this;if(!ef(e))throw new en("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");let s=new ei({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(s,{get(e,t){let s=e[t];return"function"!=typeof s?s:async(...t)=>{try{return{data:await s.apply(e,t),error:null}}catch(e){if(r)throw e;return{data:null,error:e}}}}})}};let eD={"X-Client-Info":`storage-js/${eC}`,"Content-Type":"application/json"};var eU=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function eq(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}var eL=class extends eU{constructor(e,t,s){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},eB=class extends eU{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};let eV=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),eM=e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},eK=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),eF=async(e,t,s)=>{if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==s?void 0:s.noResolveJson)){let s=e.status||500;"function"==typeof e.json?e.json().then(e=>{let r=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||s+"";t(new eL(eK(e),s,r))}).catch(()=>{t(new eL(e.statusText||`HTTP ${s} error`,s,s+""))}):t(new eL(e.statusText||`HTTP ${s} error`,s,s+""))}else t(new eB(eK(e),e))},eW=(e,t,s,r)=>{let a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?(eM(r)?(a.headers=ey({"Content-Type":"application/json"},null==t?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,ey(ey({},a),s)):a};async function eJ(e,t,s,r,a,i){return new Promise((n,o)=>{e(s,eW(t,r,a,i)).then(e=>{if(!e.ok)throw e;if(null==r?void 0:r.noResolveJson)return e;let t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>n(e)).catch(e=>eF(e,o,r))})}async function ez(e,t,s,r,a){return eJ(e,"POST",t,r,a,s)}var eG=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=ey(ey({},eD),t),this.fetch=eV(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){try{return{data:await ez(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async getIndex(e,t){try{return{data:await ez(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async listIndexes(e){try{return{data:await ez(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async deleteIndex(e,t){try{return{data:await ez(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}},eH=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=ey(ey({},eD),t),this.fetch=eV(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){try{if(e.vectors.length<1||e.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:await ez(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async getVectors(e){try{return{data:await ez(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async listVectors(e){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:await ez(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async queryVectors(e){try{return{data:await ez(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async deleteVectors(e){try{if(e.keys.length<1||e.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:await ez(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}},eY=class{constructor(e,t={},s){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=ey(ey({},eD),t),this.fetch=eV(s)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){try{return{data:await ez(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async getBucket(e){try{return{data:await ez(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async listBuckets(e={}){try{return{data:await ez(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}async deleteBucket(e){try{return{data:await ez(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers})||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eq(e))return{data:null,error:e};throw e}}},eX=class extends eY{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new eQ(this.url,this.headers,e,this.fetch)}async createBucket(e){return super.createBucket.call(this,e)}async getBucket(e){return super.getBucket.call(this,e)}async listBuckets(e={}){return super.listBuckets.call(this,e)}async deleteBucket(e){return super.deleteBucket.call(this,e)}},eQ=class extends eG{constructor(e,t,s,r){super(e,t,r),this.vectorBucketName=s}async createIndex(e){return super.createIndex.call(this,ey(ey({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(e={}){return super.listIndexes.call(this,ey(ey({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return super.getIndex.call(this,this.vectorBucketName,e)}async deleteIndex(e){return super.deleteIndex.call(this,this.vectorBucketName,e)}index(e){return new eZ(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},eZ=class extends eH{constructor(e,t,s,r,a){super(e,t,a),this.vectorBucketName=s,this.indexName=r}async putVectors(e){return super.putVectors.call(this,ey(ey({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async getVectors(e){return super.getVectors.call(this,ey(ey({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async listVectors(e={}){return super.listVectors.call(this,ey(ey({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async queryVectors(e){return super.queryVectors.call(this,ey(ey({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async deleteVectors(e){return super.deleteVectors.call(this,ey(ey({},e),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}},e0=class extends eP{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new eN(this.url,this.headers,e,this.fetch)}get vectors(){return new eX(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new eI(this.url+"/iceberg",this.headers,this.fetch)}};let e1="2.90.1",e2={"X-Client-Info":`gotrue-js/${e1}`},e4="X-Supabase-Api-Version",e3={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},e8=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class e5 extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function e6(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class e9 extends e5{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class e7 extends e5{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class te extends e5{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class tt extends te{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ts extends te{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class tr extends te{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ta extends te{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ti extends te{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tn extends te{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class to extends te{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function tl(e){return e6(e)&&"AuthRetryableFetchError"===e.name}class tc extends te{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class th extends te{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}let tu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),td=" 	\n\r=".split(""),tp=(()=>{let e=Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<td.length;t+=1)e[td[t].charCodeAt(0)]=-2;for(let t=0;t<tu.length;t+=1)e[tu[t].charCodeAt(0)]=t;return e})();function tf(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;)s(tu[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6;else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;)s(tu[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6}function tm(e,t,s){let r=tp[e];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else if(-2===r)return;else throw Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}function tg(e){let t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=e=>{(function(e,t,s){if(0===t.utf8seq){if(e<=127){s(e);return}for(let s=1;s<6;s+=1)if((e>>7-s&1)==0){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else if(4===t.utf8seq)t.codepoint=7&e;else throw Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}})(e,r,s)};for(let t=0;t<e.length;t+=1)tm(e.charCodeAt(t),a,i);return t.join("")}function ty(e){let t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)tm(e.charCodeAt(t),s,r);return new Uint8Array(t)}function tw(e){let t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>tf(e,s,r)),tf(null,s,r),t.join("")}let tb=()=>!1,tv={tested:!1,writable:!1},t_=()=>{if(!tb())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(tv.tested)return tv.writable;let e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),tv.tested=!0,tv.writable=!0}catch(e){tv.tested=!0,tv.writable=!1}return tv.writable},tx=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),tj=e=>"object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json,tk=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},tS=async(e,t)=>{let s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(e){return s}},tE=async(e,t)=>{await e.removeItem(t)};class tT{constructor(){this.promise=new tT.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function tO(e){let t=e.split(".");if(3!==t.length)throw new th("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!e8.test(t[e]))throw new th("JWT not in base64url format");return{header:JSON.parse(tg(t[0])),payload:JSON.parse(tg(t[1])),signature:ty(t[2]),raw:{header:t[0],payload:t[1]}}}async function tR(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function tA(e){return("0"+e.toString(16)).substr(-2)}async function tN(e){let t=new TextEncoder().encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(e=>String.fromCharCode(e)).join("")}async function tC(e){return"undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder?btoa(await tN(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e)}async function t$(e,t,s=!1){let r=function(){let e=new Uint32Array(56);if("undefined"==typeof crypto){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length,s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,tA).join("")}(),a=r;s&&(a+="/PASSWORD_RECOVERY"),await tk(e,`${t}-code-verifier`,a);let i=await tC(r),n=r===i?"plain":"s256";return[i,n]}tT.promiseConstructor=Promise;let tP=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,tI=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function tD(e){if(!tI.test(e))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function tU(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){let e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function tq(e){return JSON.parse(JSON.stringify(e))}let tL=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tB=[502,503,504];async function tV(e){var t;let s,r;if(!tj(e))throw new to(tL(e),0);if(tB.includes(e.status))throw new to(tL(e),e.status);try{s=await e.json()}catch(e){throw new e7(tL(e),e)}let a=function(e){let t=e.headers.get(e4);if(!t||!t.match(tP))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(a&&a.getTime()>=e3["2024-01-01"].timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?r=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(r=s.error_code),r){if("weak_password"===r)throw new tc(tL(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===r)throw new tt}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new tc(tL(s),e.status,s.weak_password.reasons);throw new e9(tL(s),e.status||500,r)}let tM=(e,t,s,r)=>{let a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))};async function tK(e,t,s,r){var a;let i=Object.assign({},null==r?void 0:r.headers);i[e4]||(i[e4]=e3["2024-01-01"].name),(null==r?void 0:r.jwt)&&(i.Authorization=`Bearer ${r.jwt}`);let n=null!==(a=null==r?void 0:r.query)&&void 0!==a?a:{};(null==r?void 0:r.redirectTo)&&(n.redirect_to=r.redirectTo);let o=Object.keys(n).length?"?"+new URLSearchParams(n).toString():"",l=await tF(e,t,s+o,{headers:i,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function tF(e,t,s,r,a,i){let n;let o=tM(t,r,a,i);try{n=await e(s,Object.assign({},o))}catch(e){throw console.error(e),new to(tL(e),0)}if(n.ok||await tV(n),null==r?void 0:r.noResolveJson)return n;try{return await n.json()}catch(e){await tV(e)}}function tW(e){var t,s;let r=null;return e.access_token&&e.refresh_token&&e.expires_in&&(r=Object.assign({},e),!e.expires_at)&&(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)),{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function tJ(e){let t=tW(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function tz(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function tG(e){return{data:e,error:null}}function tH(e){let{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i}=e;return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:i},user:Object.assign({},y(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function tY(e){return e}let tX=["global","local","others"];class tQ{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=tx(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=tX[0]){if(0>tX.indexOf(t))throw Error(`@supabase/auth-js: Parameter scope must be one of ${tX.join(", ")}`);try{return await tK(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(e6(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await tK(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:tz})}catch(e){if(e6(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{let{options:t}=e,s=y(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await tK(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:tH,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(e6(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await tK(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:tz})}catch(e){if(e6(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,s,r,a,i,n,o;try{let l={nextPage:null,lastPage:0,total:0},c=await tK(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:tY});if(c.error)throw c.error;let h=await c.json(),u=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(o=null===(n=c.headers.get("link"))||void 0===n?void 0:n.split(","))&&void 0!==o?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(e){if(e6(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){tD(e);try{return await tK(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:tz})}catch(e){if(e6(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){tD(e);try{return await tK(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:tz})}catch(e){if(e6(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){tD(e);try{return await tK(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:tz})}catch(e){if(e6(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){tD(e.userId);try{let{data:t,error:s}=await tK(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(e){if(e6(e))return{data:null,error:e};throw e}}async _deleteFactor(e){tD(e.userId),tD(e.id);try{return{data:await tK(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(e6(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,s,r,a,i,n,o;try{let l={nextPage:null,lastPage:0,total:0},c=await tK(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:tY});if(c.error)throw c.error;let h=await c.json(),u=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(o=null===(n=c.headers.get("link"))||void 0===n?void 0:n.split(","))&&void 0!==o?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(e){if(e6(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await tK(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(e6(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await tK(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(e6(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await tK(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(e6(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await tK(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(e6(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await tK(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(e6(e))return{data:null,error:e};throw e}}}function tZ(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}let t0={debug:!!(globalThis&&t_()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class t1 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class t2 extends t1{}async function t4(e,t,s){t0.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);let r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),t0.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(r){t0.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{t0.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}else{if(0===t)throw t0.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new t2(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(t0.debug)try{let e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}function t3(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}class t8 extends Error{constructor({message:e,code:t,cause:s,name:r}){var a;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=null!==(a=null!=r?r:s instanceof Error?s.name:void 0)&&void 0!==a?a:"Unknown Error",this.code=t}}class t5 extends t8{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}class t6{createNewAbortSignal(){if(this.controller){let e=Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}let t9=new t6;function t7(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function se(){var e,t;return!!(tb()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null==navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null==navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}async function st(e){try{let t=await navigator.credentials.create(e);if(!t)return{data:null,error:new t5("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new t5("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function({error:e,options:t}){var s,r,a;let{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new t8({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if((null===(s=i.authenticatorSelection)||void 0===s?void 0:s.requireResidentKey)===!0)return new t8({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.userVerification)==="required")return new t8({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if((null===(a=i.authenticatorSelection)||void 0===a?void 0:a.userVerification)==="required")return new t8({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else if("InvalidStateError"===e.name)return new t8({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});else if("NotAllowedError"===e.name)return new t8({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("NotSupportedError"===e.name)return new t8(0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!t7(t))return new t8({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new t8({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new t8({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new t8({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return new t8({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}({error:t,options:e})}}}async function ss(e){try{let t=await navigator.credentials.get(e);if(!t)return{data:null,error:new t5("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new t5("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function({error:e,options:t}){let{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new t8({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("NotAllowedError"===e.name)return new t8({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!t7(t))return new t8({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(s.rpId!==t)return new t8({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new t8({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return new t8({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}({error:t,options:e})}}}let sr={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},sa={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function si(...e){let t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),s=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),r={};for(let a of e)if(a)for(let e in a){let i=a[e];if(void 0!==i){if(Array.isArray(i))r[e]=i;else if(s(i))r[e]=i;else if(t(i)){let s=r[e];t(s)?r[e]=si(s,i):r[e]=si(i)}else r[e]=i}}return r}class sn{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:s,signal:r},a){try{var i,n,o,l;let{data:c,error:h}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!c)return{data:null,error:h};let u=null!=r?r:t9.createNewAbortSignal();if("create"===c.webauthn.type){let{user:e}=c.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${s}`),e.displayName||(e.displayName=e.name)}switch(c.webauthn.type){case"create":{let t=(i=c.webauthn.credential_options.publicKey,n=null==a?void 0:a.create,si(sr,i,n||{})),{data:s,error:r}=await st({publicKey:t,signal:u});if(s)return{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:s}},error:null};return{data:null,error:r}}case"request":{let t=(o=c.webauthn.credential_options.publicKey,l=null==a?void 0:a.request,si(sa,o,l||{})),{data:s,error:r}=await ss(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:t,signal:u}));if(s)return{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:s}},error:null};return{data:null,error:r}}}}catch(e){if(e6(e))return{data:null,error:e};return{data:null,error:new e7("Unexpected error in challenge",e)}}}async _verify({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})}async _authenticate({factorId:e,webauthn:{rpId:t,rpOrigins:s,signal:r}={}},a){if(!t)return{data:null,error:new e5("rpId is required for WebAuthn authentication")};try{if(!se())return{data:null,error:new e7("Browser does not support WebAuthn",null)};let{data:i,error:n}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:r},{request:a});if(!i)return{data:null,error:n};let{webauthn:o}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:s,credential_response:o.credential_response}})}catch(e){if(e6(e))return{data:null,error:e};return{data:null,error:new e7("Unexpected error in authenticate",e)}}}async _register({friendlyName:e,webauthn:{rpId:t,rpOrigins:s,signal:r}={}},a){if(!t)return{data:null,error:new e5("rpId is required for WebAuthn registration")};try{if(!se())return{data:null,error:new e7("Browser does not support WebAuthn",null)};let{data:i,error:n}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var s;return null===(s=t.data)||void 0===s?void 0:s.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:n};let{data:o,error:l}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:r},{create:a});if(!o)return{data:null,error:l};return this._verify({factorId:i.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:s,type:o.webauthn.type,credential_response:o.webauthn.credential_response}})}catch(e){if(e6(e))return{data:null,error:e};return{data:null,error:new e7("Unexpected error in register",e)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();let so={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:e2,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function sl(e,t,s){return await s()}let sc={};class sh{get jwks(){var e,t;return null!==(t=null===(e=sc[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){sc[this.storageKey]=Object.assign(Object.assign({},sc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=sc[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){sc[this.storageKey]=Object.assign(Object.assign({},sc[this.storageKey]),{cachedAt:e})}constructor(e){var t,s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;let a=Object.assign(Object.assign({},so),e);if(this.storageKey=a.storageKey,this.instanceID=null!==(t=sh.nextInstanceID[this.storageKey])&&void 0!==t?t:0,sh.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,"function"==typeof a.debug&&(this.logger=a.debug),this.instanceID>0&&tb()){let e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new tQ({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=tx(a.fetch),this.lock=a.lock||sl,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,this.lockAcquireTimeout=a.lockAcquireTimeout,a.lock?this.lock=a.lock:this.persistSession&&tb()&&(null===(s=null==globalThis?void 0:globalThis.navigator)||void 0===s?void 0:s.locks)?this.lock=t4:this.lock=sl,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new sn(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:t_()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=tZ(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=tZ(this.memoryStorage)),tb()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${e1}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},s="none";if(tb()&&(t=function(e){let t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(e){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce")),tb()&&this.detectSessionInUrl&&"none"!==s){let{data:r,error:a}=await this._getSessionFromURL(t,s);if(a)return this._debug("#_initialize()","error detecting session from URL",a),e6(a)&&"AuthImplicitGrantRedirectError"===a.name&&(null===(e=a.details)||void 0===e||e.code),{error:a};let{session:i,redirectType:n}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),await this._saveSession(i),setTimeout(async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){if(e6(e))return this._returnResult({error:e});return this._returnResult({error:new e7("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{let{data:a,error:i}=await tK(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:tW});if(i||!a)return this._returnResult({data:{user:null,session:null},error:i});let n=a.session,o=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",n)),this._returnResult({data:{user:o,session:n},error:null})}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signUp(e){var t,s,r;try{let a;if("email"in e){let{email:s,password:r,options:i}=e,n=null,o=null;"pkce"===this.flowType&&([n,o]=await t$(this.storage,this.storageKey)),a=await tK(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:o},xform:tW})}else if("phone"in e){let{phone:t,password:i,options:n}=e;a=await tK(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(s=null==n?void 0:n.data)&&void 0!==s?s:{},channel:null!==(r=null==n?void 0:n.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:tW})}else throw new tr("You must provide either an email or phone number and a password");let{data:i,error:n}=a;if(n||!i)return await tE(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:n});let o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(await tE(this.storage,`${this.storageKey}-code-verifier`),e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithPassword(e){try{let t;if("email"in e){let{email:s,password:r,options:a}=e;t=await tK(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:tJ})}else if("phone"in e){let{phone:s,password:r,options:a}=e;t=await tK(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:tJ})}else throw new tr("You must provide either an email or phone number and a password");let{data:s,error:r}=t;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!s||!s.session||!s.user){let e=new ts;return this._returnResult({data:{user:null,session:null},error:e})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(e){var t,s,r,a;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,s,r,a,i,n,o,l,c,h,u,d;let p,f;if("message"in e)p=e.message,f=e.signature;else{let h;let{chain:u,wallet:m,statement:g,options:y}=e;if(tb()){if("object"==typeof m)h=m;else{let e=window;if("ethereum"in e&&"object"==typeof e.ethereum&&"request"in e.ethereum&&"function"==typeof e.ethereum.request)h=e.ethereum;else throw Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}}else{if("object"!=typeof m||!(null==y?void 0:y.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");h=m}let w=new URL(null!==(t=null==y?void 0:y.url)&&void 0!==t?t:window.location.href),b=await h.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!b||0===b.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let v=t3(b[0]),_=null===(s=null==y?void 0:y.signInWithEthereum)||void 0===s?void 0:s.chainId;_||(_=parseInt(await h.request({method:"eth_chainId"}),16)),p=function(e){var t;let{chainId:s,domain:r,expirationTime:a,issuedAt:i=new Date,nonce:n,notBefore:o,requestId:l,resources:c,scheme:h,uri:u,version:d}=e;if(!Number.isInteger(s))throw Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!r)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(n&&n.length<8)throw Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${n}`);if(!u)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==d)throw Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);let p=t3(e.address),f=h?`${h}://${r}`:r,m=e.statement?`${e.statement}
`:"",g=`${f} wants you to sign in with your Ethereum account:
${p}

${m}`,y=`URI: ${u}
Version: ${d}
Chain ID: ${s}${n?`
Nonce: ${n}`:""}
Issued At: ${i.toISOString()}`;if(a&&(y+=`
Expiration Time: ${a.toISOString()}`),o&&(y+=`
Not Before: ${o.toISOString()}`),l&&(y+=`
Request ID: ${l}`),c){let e="\nResources:";for(let t of c){if(!t||"string"!=typeof t)throw Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`
- ${t}`}y+=e}return`${g}
${y}`}({domain:w.host,address:v,statement:g,uri:w.href,version:"1",chainId:_,nonce:null===(r=null==y?void 0:y.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(i=null===(a=null==y?void 0:y.signInWithEthereum)||void 0===a?void 0:a.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(n=null==y?void 0:y.signInWithEthereum)||void 0===n?void 0:n.expirationTime,notBefore:null===(o=null==y?void 0:y.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null==y?void 0:y.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==y?void 0:y.signInWithEthereum)||void 0===c?void 0:c.resources}),f=await h.request({method:"personal_sign",params:[(d=p,"0x"+Array.from(new TextEncoder().encode(d),e=>e.toString(16).padStart(2,"0")).join("")),v]})}try{let{data:t,error:s}=await tK(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:f},(null===(h=e.options)||void 0===h?void 0:h.captchaToken)?{gotrue_meta_security:{captcha_token:null===(u=e.options)||void 0===u?void 0:u.captchaToken}}:null),xform:tW});if(s)throw s;if(!t||!t.session||!t.user){let e=new ts;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:s})}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSolana(e){var t,s,r,a,i,n,o,l,c,h,u,d;let p,f;if("message"in e)p=e.message,f=e.signature;else{let u;let{chain:d,wallet:m,statement:g,options:y}=e;if(tb()){if("object"==typeof m)u=m;else{let e=window;if("solana"in e&&"object"==typeof e.solana&&("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))u=e.solana;else throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}}else{if("object"!=typeof m||!(null==y?void 0:y.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");u=m}let w=new URL(null!==(t=null==y?void 0:y.url)&&void 0!==t?t:window.location.href);if("signIn"in u&&u.signIn){let e;let t=await u.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},null==y?void 0:y.signInWithSolana),{version:"1",domain:w.host,uri:w.href}),g?{statement:g}:null));if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else if(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t)e=t;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array)p="string"==typeof e.signedMessage?e.signedMessage:new TextDecoder().decode(e.signedMessage),f=e.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in u)||"function"!=typeof u.signMessage||!("publicKey"in u)||"object"!=typeof u||!u.publicKey||!("toBase58"in u.publicKey)||"function"!=typeof u.publicKey.toBase58)throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${w.host} wants you to sign in with your Solana account:`,u.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${w.href}`,`Issued At: ${null!==(r=null===(s=null==y?void 0:y.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:new Date().toISOString()}`,...(null===(a=null==y?void 0:y.signInWithSolana)||void 0===a?void 0:a.notBefore)?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...(null===(i=null==y?void 0:y.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...(null===(n=null==y?void 0:y.signInWithSolana)||void 0===n?void 0:n.chainId)?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...(null===(o=null==y?void 0:y.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...(null===(l=null==y?void 0:y.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...(null===(h=null===(c=null==y?void 0:y.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===h?void 0:h.length)?["Resources",...y.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");let e=await u.signMessage(new TextEncoder().encode(p),"utf8");if(!e||!(e instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");f=e}}try{let{data:t,error:s}=await tK(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:tw(f)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:tW});if(s)throw s;if(!t||!t.session||!t.user){let e=new ts;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:s})}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _exchangeCodeForSession(e){let t=await tS(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{if(!s&&"pkce"===this.flowType)throw new tn;let{data:t,error:a}=await tK(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:tW});if(await tE(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!t||!t.session||!t.user){let e=new ts;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:a})}catch(e){if(await tE(this.storage,`${this.storageKey}-code-verifier`),e6(e))return this._returnResult({data:{user:null,session:null,redirectType:null},error:e});throw e}}async signInWithIdToken(e){try{let{options:t,provider:s,token:r,access_token:a,nonce:i}=e,{data:n,error:o}=await tK(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:a,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:tW});if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!n||!n.session||!n.user){let e=new ts;return this._returnResult({data:{user:null,session:null},error:e})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:n,error:o})}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(e){var t,s,r,a,i;try{if("email"in e){let{email:r,options:a}=e,i=null,n=null;"pkce"===this.flowType&&([i,n]=await t$(this.storage,this.storageKey));let{error:o}=await tK(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},create_user:null===(s=null==a?void 0:a.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:n},redirectTo:null==a?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){let{phone:t,options:s}=e,{data:n,error:o}=await tK(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(a=null==s?void 0:s.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(i=null==s?void 0:s.channel)&&void 0!==i?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o})}throw new tr("You must provide either an email or phone number.")}catch(e){if(await tE(this.storage,`${this.storageKey}-code-verifier`),e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async verifyOtp(e){var t,s;try{let r,a;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);let{data:i,error:n}=await tK(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:r,xform:tW});if(n)throw n;if(!i)throw Error("An error occurred on token verification.");let o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSSO(e){var t,s,r,a,i;try{let n=null,o=null;"pkce"===this.flowType&&([n,o]=await t$(this.storage,this.storageKey));let l=await tK(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:tG});return(null===(a=l.data)||void 0===a?void 0:a.url)&&tb()&&!(null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(e){if(await tE(this.storage,`${this.storageKey}-code-verifier`),e6(e))return this._returnResult({data:null,error:e});throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new tt;let{error:r}=await tK(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:s,type:r,options:a}=e,{error:i}=await tK(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){let{phone:s,type:r,options:a}=e,{data:i,error:n}=await tK(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:n})}throw new tr("You must provide either an email or phone number and a type")}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){let e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let t=null,s=await tS(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),null!==s&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};let r=!!t.expires_at&&1e3*t.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){let e=await tS(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=tU()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){var e;let s={value:this.suppressGetSessionWarning};t.user=(e=t.user,new Proxy(e,{get:(e,t,r)=>{if("__isInsecureUserWarningProxy"===t)return!0;if("symbol"==typeof t){let s=t.toString();if("Symbol(Symbol.toPrimitive)"===s||"Symbol(Symbol.toStringTag)"===s||"Symbol(util.inspect.custom)"===s||"Symbol(nodejs.util.inspect.custom)"===s)return Reflect.get(e,t,r)}return s.value||"string"!=typeof t||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),s.value=!0),Reflect.get(e,t,r)}})),s.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}let{data:a,error:i}=await this._callRefreshToken(t.refresh_token);if(i)return this._returnResult({data:{session:null},error:i});return this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;let t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{if(e)return await tK(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:tz});return await this._useSession(async e=>{var t,s,r;let{data:a,error:i}=e;if(i)throw i;return(null===(t=a.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await tK(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:tz}):{data:{user:null},error:new tt}})}catch(e){if(e6(e))return e6(e)&&"AuthSessionMissingError"===e.name&&(await this._removeSession(),await tE(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{let{data:r,error:a}=s;if(a)throw a;if(!r.session)throw new tt;let i=r.session,n=null,o=null;"pkce"===this.flowType&&null!=e.email&&([n,o]=await t$(this.storage,this.storageKey));let{data:l,error:c}=await tK(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:n,code_challenge_method:o}),jwt:i.access_token,xform:tz});if(c)throw c;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(e){if(await tE(this.storage,`${this.storageKey}-code-verifier`),e6(e))return this._returnResult({data:{user:null},error:e});throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new tt;let t=Date.now()/1e3,s=t,r=!0,a=null,{payload:i}=tO(e.access_token);if(i.exp&&(r=(s=i.exp)<=t),r){let{data:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!t)return{data:{user:null,session:null},error:null};a=t}else{let{data:r,error:i}=await this._getUser(e.access_token);if(i)throw i;a={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(e){if(e6(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){let{data:r,error:a}=t;if(a)throw a;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new tt;let{data:r,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(e,t){try{if(!tb())throw new ta("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ta(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new ti("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new ta("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ti("No code detected.");let{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;let r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}let{provider_token:s,provider_refresh_token:r,access_token:a,refresh_token:i,expires_in:n,expires_at:o,token_type:l}=e;if(!a||!n||!i||!l)throw new ta("No session defined in URL");let c=Math.round(Date.now()/1e3),h=parseInt(n),u=c+h;o&&(u=parseInt(o));let d=u-c;1e3*d<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);let p=u-h;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,u,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,u,c);let{data:f,error:m}=await this._getUser(a);if(m)throw m;let g={provider_token:s,provider_refresh_token:r,access_token:a,expires_in:h,expires_at:u,refresh_token:i,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(e){if(e6(e))return this._returnResult({data:{session:null,redirectType:null},error:e});throw e}}_isImplicitGrantCallback(e){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await tS(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;let{data:r,error:a}=t;if(a)return this._returnResult({error:a});let i=null===(s=r.session)||void 0===s?void 0:s.access_token;if(i){let{error:t}=await this.admin.signOut(i,e);if(t&&!(e6(t)&&"AuthApiError"===t.name&&(404===t.status||401===t.status||403===t.status)))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await tE(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){let t=Symbol("auth-callback"),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{let{data:{session:r},error:a}=t;if(a)throw a;await (null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(t){await (null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await t$(this.storage,this.storageKey,!0));try{return await tK(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(await tE(this.storage,`${this.storageKey}-code-verifier`),e6(e))return this._returnResult({data:null,error:e});throw e}}async getUserIdentities(){var e;try{let{data:t,error:s}=await this.getUser();if(s)throw s;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{let{data:s,error:r}=await this._useSession(async t=>{var s,r,a,i,n;let{data:o,error:l}=t;if(l)throw l;let c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});return await tK(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(n=null===(i=o.session)||void 0===i?void 0:i.access_token)&&void 0!==n?n:void 0})});if(r)throw r;return!tb()||(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)||window.location.assign(null==s?void 0:s.url),this._returnResult({data:{provider:e.provider,url:null==s?void 0:s.url},error:null})}catch(t){if(e6(t))return this._returnResult({data:{provider:e.provider,url:null},error:t});throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var s;try{let{error:r,data:{session:a}}=t;if(r)throw r;let{options:i,provider:n,token:o,access_token:l,nonce:c}=e,{data:h,error:u}=await tK(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(s=null==a?void 0:a.access_token)&&void 0!==s?s:void 0,body:{provider:n,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:tW});if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!h||!h.session||!h.user)return this._returnResult({data:{user:null,session:null},error:new ts});return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:u})}catch(e){if(await tE(this.storage,`${this.storageKey}-code-verifier`),e6(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;let{data:a,error:i}=t;if(i)throw i;return await tK(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{var s,r;let a=Date.now();return await (s=async s=>(s>0&&await tR(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await tK(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:tW})),r=(e,t)=>t&&tl(t)&&Date.now()+200*Math.pow(2,e)-a<3e4,new Promise((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{let t=await s(a);if(!r(a,null,t)){e(t);return}}catch(e){if(!r(a,e)){t(e);return}}})()}))}catch(e){if(this._debug(t,"error",e),e6(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),tb()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;let s="#_recoverAndRefresh()";this._debug(s,"begin");try{let r=await tS(this.storage,this.storageKey);if(r&&this.userStorage){let t=await tS(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!t&&(t={user:r.user},await tk(this.userStorage,this.storageKey+"-user",t)),r.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:tU()}else if(r&&!r.user&&!r.user){let e=await tS(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(r.user=e.user,await tE(this.storage,this.storageKey+"-user"),await tk(this.storage,this.storageKey,r)):r.user=tU()}if(this._debug(s,"session from storage",r),!this._isValidSession(r)){this._debug(s,"session is not valid"),null!==r&&await this._removeSession();return}let a=(null!==(t=r.expires_at)&&void 0!==t?t:1/0)*1e3-Date.now()<9e4;if(this._debug(s,`session has${a?"":" not"} expired with margin of 90000s`),a){if(this.autoRefreshToken&&r.refresh_token){let{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),tl(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(r.user&&!0===r.user.__isUserNotAvailableProxy)try{let{data:e,error:t}=await this._getUser(r.access_token);!t&&(null==e?void 0:e.user)?(r.user=e.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(s,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(e){this._debug(s,"error",e),console.error(e);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new tt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new tT;let{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new tt;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);let r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(e){if(this._debug(r,"error",e),e6(e)){let s={data:null,error:e};return tl(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(s),s}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(e),e}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){let r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});let r=[],a=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(e){r.push(e)}});if(await Promise.all(a),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await tE(this.storage,`${this.storageKey}-code-verifier`);let t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&await tk(this.userStorage,this.storageKey+"-user",{user:t.user});let e=Object.assign({},t);delete e.user;let r=tq(e);await tk(this.storage,this.storageKey,r)}else{let e=tq(t);await tk(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await tE(this.storage,this.storageKey),await tE(this.storage,this.storageKey+"-code-verifier"),await tE(this.storage,this.storageKey+"-user"),this.userStorage&&await tE(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&tb()&&(null==window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e);let t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);let t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let r=Math.floor((1e3*s.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof t1)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tb()||!(null==window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null==window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if("visible"!==document.visibilityState){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){let r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){let[e,t]=await t$(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){let e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;let{data:r,error:a}=t;return a?this._returnResult({data:null,error:a}):await tK(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;let{data:a,error:i}=t;if(i)return this._returnResult({data:null,error:i});let n=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await tK(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:null===(s=null==a?void 0:a.session)||void 0===s?void 0:s.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),this._returnResult({data:o,error:null}))})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var s,r,a;let{data:i,error:n}=t;if(n)return this._returnResult({data:null,error:n});let o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?(r=e.webauthn.credential_response,"toJSON"in r&&"function"==typeof r.toJSON?r.toJSON():{id:r.id,rawId:r.id,response:{attestationObject:tw(new Uint8Array(r.response.attestationObject)),clientDataJSON:tw(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:null!==(a=r.authenticatorAttachment)&&void 0!==a?a:void 0}):function(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();let s=e.getClientExtensionResults(),r=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:tw(new Uint8Array(r.authenticatorData)),clientDataJSON:tw(new Uint8Array(r.clientDataJSON)),signature:tw(new Uint8Array(r.signature)),userHandle:r.userHandle?tw(new Uint8Array(r.userHandle)):void 0},type:"public-key",clientExtensionResults:s,authenticatorAttachment:null!==(t=e.authenticatorAttachment)&&void 0!==t?t:void 0}}(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await tK(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var s;let{data:r,error:a}=t;if(a)return this._returnResult({data:null,error:a});let i=await tK(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});if(i.error)return i;let{data:n}=i;if("webauthn"!==n.type)return{data:n,error:null};switch(n.webauthn.type){case"create":return{data:Object.assign(Object.assign({},n),{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_options:Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);let{challenge:t,user:s,excludeCredentials:r}=e,a=y(e,["challenge","user","excludeCredentials"]),i=ty(t).buffer,n=Object.assign(Object.assign({},s),{id:ty(s.id).buffer}),o=Object.assign(Object.assign({},a),{challenge:i,user:n});if(r&&r.length>0){o.excludeCredentials=Array(r.length);for(let e=0;e<r.length;e++){let t=r[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:ty(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}(n.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},n),{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_options:Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);let{challenge:t,allowCredentials:s}=e,r=y(e,["challenge","allowCredentials"]),a=ty(t).buffer,i=Object.assign(Object.assign({},r),{challenge:a});if(s&&s.length>0){i.allowCredentials=Array(s.length);for(let e=0;e<s.length;e++){let t=s[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:ty(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}(n.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(e){let{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?this._returnResult({data:null,error:s}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;let{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};let r={all:[],phone:[],totp:[],webauthn:[]};for(let s of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(s),"verified"===s.status&&r[s.factor_type].push(s);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;let{data:{session:s},error:r}=await this.getSession();if(r)return this._returnResult({data:null,error:r});if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:a}=tO(s.access_token),i=null;a.aal&&(i=a.aal);let n=i;return(null!==(t=null===(e=s.user.factors)||void 0===e?void 0:e.filter(e=>"verified"===e.status))&&void 0!==t?t:[]).length>0&&(n="aal2"),{data:{currentLevel:i,nextLevel:n,currentAuthenticationMethods:a.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{let{data:{session:s},error:r}=t;return r?this._returnResult({data:null,error:r}):s?await tK(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:s.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new tt})})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async s=>{let{data:{session:r},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!r)return this._returnResult({data:null,error:new tt});let i=await tK(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&tb()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async s=>{let{data:{session:r},error:a}=s;if(a)return this._returnResult({data:null,error:a});if(!r)return this._returnResult({data:null,error:new tt});let i=await tK(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&tb()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async _listOAuthGrants(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;return s?this._returnResult({data:null,error:s}):t?await tK(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new tt})})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{let{data:{session:s},error:r}=t;return r?this._returnResult({data:null,error:r}):s?(await tK(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:s.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new tt})})}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;let r=Date.now();if((s=this.jwks.keys.find(t=>t.kid===e))&&this.jwks_cached_at+6e5>r)return s;let{data:a,error:i}=await tK(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return a.keys&&0!==a.keys.length&&(this.jwks=a,this.jwks_cached_at=r,s=a.keys.find(t=>t.kid===e))?s:null}async getClaims(e,t={}){try{let s=e;if(!s){let{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});s=e.session.access_token}let{header:r,payload:a,signature:i,raw:{header:n,payload:o}}=tO(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(a.exp);let l=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks);if(!l){let{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:a,header:r,signature:i},error:null}}let c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(r.alg),h=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!await crypto.subtle.verify(c,h,i,function(e){let t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){let t=(r-55296)*1024&65535;r=(e.charCodeAt(s+1)-56320&65535|t)+65536,s+=1}!function(e,t){if(e<=127){t(e);return}if(e<=2047){t(192|e>>6),t(128|63&e);return}if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|63&e);return}if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|63&e);return}throw Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}(`${n}.${o}`)))throw new th("Invalid JWT signature");return{data:{claims:a,header:r,signature:i},error:null}}catch(e){if(e6(e))return this._returnResult({data:null,error:e});throw e}}}sh.nextInstanceID={};let su=sh,sd="";sd="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let sp={headers:{"X-Client-Info":`supabase-js-${sd}/2.90.1`}},sf={schema:"public"},sm={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},sg={};function sy(e){return(sy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sw(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,r)}return s}function sb(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?sw(Object(s),!0).forEach(function(t){!function(e,t,s){var r;(r=function(e,t){if("object"!=sy(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var r=s.call(e,t||"default");if("object"!=sy(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==sy(r)?r:r+"")in e)?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s}(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):sw(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}let sv=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),s_=()=>Headers,sx=(e,t,s)=>{let r=sv(s),a=s_();return async(s,i)=>{var n;let o=null!==(n=await t())&&void 0!==n?n:e,l=new a(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,sb(sb({},i),{},{headers:l}))}};var sj=class extends su{constructor(e){super(e)}},sk=class{constructor(e,t,s){var r,a,i;this.supabaseUrl=e,this.supabaseKey=t;let n=function(e){let t=null==e?void 0:e.trim();if(!t)throw Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(t.endsWith("/")?t:t+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(e);if(!t)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);let o=`sb-${n.hostname.split(".")[0]}-auth-token`,l=function(e,t){var s,r;let{db:a,auth:i,realtime:n,global:o}=e,{db:l,auth:c,realtime:h,global:u}=t,d={db:sb(sb({},l),a),auth:sb(sb({},c),i),realtime:sb(sb({},h),n),storage:{},global:sb(sb(sb({},u),o),{},{headers:sb(sb({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:async()=>""};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=s?s:{},{db:sf,realtime:sg,auth:sb(sb({},sm),{},{storageKey:o}),global:sp});this.storageKey=null!==(r=l.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(a=l.global.headers)&&void 0!==a?a:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=l.auth)&&void 0!==i?i:{},this.headers,l.global.fetch),this.fetch=sx(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(sb({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new A(new URL("rest/v1",n).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new e0(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new j(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:s}=await this.auth.getSession();return null!==(e=null===(t=s.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:a,storageKey:i,flowType:n,lock:o,debug:l,throwOnError:c},h,u){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new sj({url:this.authUrl.href,headers:sb(sb({},d),h),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:a,flowType:n,lock:o,debug:l,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Q(this.realtimeUrl.href,sb(sb({},e),{},{params:sb(sb({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==s?(this.changedAccessToken=s,this.realtime.setAuth(s)):"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}};(function(){let e=globalThis.process;if(!e)return!1;let t=e.version;if(null==t)return!1;let s=t.match(/^v(\d+)\./);return!!s&&18>=parseInt(s[1],10)})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");let sS=new sk("https://enreskfzejsoiyzfrxmq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVucmVza2Z6ZWpzb2l5emZyeG1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NDYwODMsImV4cCI6MjA4NDMyMjA4M30.deO_NVs9tP_ds7crQyDRJXtEWtB3YPHF7UDeVYiOlz0",void 0);class sE{static{this.SEASONS=["spring","summer","autumn","winter"]}static{this.SEASON_NAMES={spring:"Primavera",summer:"Ver\xe3o",autumn:"Outono",winter:"Inverno"}}static getCurrentTime(e){let t=e.current_year-e.birth_year,s=this.getSeason(t),r=t%12+1;return{currentYear:e.current_year,currentSeason:s,currentMonth:r}}static getSeason(e){return this.SEASONS[e%4]}static advanceTime(e,t=1){let s=e.current_year+Math.floor(t/12),r=e.age+Math.floor(t/12);return{...e,current_year:s,age:r,is_alive:r<80,death_reason:r>=80?"velhice":e.death_reason}}static getAgeEvents(e){let t=[];return 16===e&&t.push({age:16,title:"Cerim\xf4nia de Maioridade",description:"Voc\xea completou 16 anos e est\xe1 pronto para se tornar um guerreiro. Seu cl\xe3 organiza uma cerim\xf4nia para marcar sua transi\xe7\xe3o para a vida adulta.",choices:[{text:"Dedicar-se ao treinamento de espada",consequence:"Voc\xea se torna um espadachim habilidoso, mas negligencia seus estudos.",effects:{strength:5,intelligence:-2}},{text:"Estudar estrat\xe9gia com os anci\xe3os",consequence:"Voc\xea se torna um estrategista brilhante, mas sua for\xe7a f\xedsica fica aqu\xe9m do esperado.",effects:{intelligence:5,strength:-2}},{text:"Equilibrar treinamento e estudos",consequence:"Voc\xea se torna um guerreiro completo, embora n\xe3o se destaque em nenhuma \xe1rea espec\xedfica.",effects:{strength:2,intelligence:2}}]}),20===e&&t.push({age:20,title:"Primeira Batalha",description:"Seu cl\xe3 est\xe1 em conflito com um cl\xe3 rival. Esta \xe9 sua primeira verdadeira batalha como samurai.",choices:[{text:"Lutar na linha de frente",consequence:"Sua coragem \xe9 notada, mas voc\xea sofre ferimentos graves.",effects:{honor:10,health:-20}},{text:"Atuar como arqueiro de apoio",consequence:"Voc\xea contribui para a vit\xf3ria sem se expor demais.",effects:{honor:5,health:-5}},{text:"Proteger o comandante",consequence:"Sua lealdade \xe9 recompensada com promo\xe7\xe3o.",effects:{honor:15,gold:20}}]}),25===e&&t.push({age:25,title:"Casamento Arranjado",description:"Seu cl\xe3 prop\xf5e um casamento estrat\xe9gico com outro cl\xe3 para fortalecer alian\xe7as.",choices:[{text:"Aceitar o casamento",consequence:"A alian\xe7a fortalece seu cl\xe3, mas voc\xea sacrifica seu amor pessoal.",effects:{honor:10,charisma:3}},{text:"Recusar educadamente",consequence:"Voc\xea mant\xe9m sua liberdade, mas desagrada alguns anci\xe3os.",effects:{honor:-5,charisma:5}},{text:"Negociar melhores termos",consequence:"Voc\xea demonstra sabedoria pol\xedtica e obt\xe9m vantagens.",effects:{intelligence:5,gold:30}}]}),35===e&&t.push({age:35,title:"Posi\xe7\xe3o de Lideran\xe7a",description:"Sua experi\xeancia e reputa\xe7\xe3o lhe rendem uma posi\xe7\xe3o de lideran\xe7a no cl\xe3.",choices:[{text:"Aceitar o cargo de comandante",consequence:"Voc\xea se torna um l\xedder respeitado, mas o peso da responsabilidade \xe9 grande.",effects:{honor:20,health:-10}},{text:"Tornar-se conselheiro",consequence:"Voc\xea influencia as decis\xf5es sem o fardo do comando direto.",effects:{intelligence:10,honor:10}},{text:"Recusar para manter liberdade",consequence:"Voc\xea prefere a liberdade do campo de batalha \xe0 pol\xedtica.",effects:{strength:5,charisma:-5}}]}),50===e&&t.push({age:50,title:"Herdeiro",description:"Seus filhos j\xe1 cresceram e est\xe3o prontos para seguir seus passos.",choices:[{text:"Treinar seu filho mais velho",consequence:"Seu filho se torna um guerreiro digno de seu legado.",effects:{honor:15,charisma:5}},{text:"Deixar os filhos escolherem seus caminhos",consequence:"Seus filhos encontram seus pr\xf3prios destinos.",effects:{intelligence:5,honor:5}},{text:"Aposentar-se e meditar",consequence:"Voc\xea encontra paz interior na velhice.",effects:{health:20,intelligence:10}}]}),t}static checkDeath(e){if(e.age>=80)return{isDead:!0,reason:"velhice"};if(e.health<=0)return{isDead:!0,reason:"ferimentos"};if(e.age>=60&&Math.random()<(e.age-60)*.01){let e=["doen\xe7a","acidente","envenenamento"];return{isDead:!0,reason:e[Math.floor(Math.random()*e.length)]}}return{isDead:!1}}}function sT({character:e,onCharacterUpdate:t}){let[s,r]=(0,g.useState)(sE.getCurrentTime(e)),[a,i]=(0,g.useState)(null),[n,o]=(0,g.useState)([]);(0,g.useEffect)(()=>{let t=sE.getAgeEvents(e.age).find(e=>!0);t&&i(t)},[e.age]);let l=async n=>{if(!a)return;let l={...e,health:Math.max(0,Math.min(100,e.health+(n.effects.health||0))),honor:Math.max(0,Math.min(100,e.honor+(n.effects.honor||0))),gold:Math.max(0,e.gold+(n.effects.gold||0)),strength:Math.max(1,e.strength+(n.effects.strength||0)),agility:Math.max(1,e.agility+(n.effects.agility||0)),intelligence:Math.max(1,e.intelligence+(n.effects.intelligence||0)),charisma:Math.max(1,e.charisma+(n.effects.charisma||0))},{error:c}=await sS.from("characters").update(l).eq("id",e.id);if(c){alert("Erro ao salvar: "+c.message);return}o(e=>[`${s.currentYear} - ${a.title}`,`Sua escolha: ${n.text}`,n.consequence,"",...e]),await sS.from("game_events").insert({character_id:e.id,event_type:"age_event",title:a.title,description:a.description,choices:a.choices.map(e=>e.text),consequences:[n.consequence],year:s.currentYear});let h=sE.checkDeath(l);if(h.isDead){let s={...l,is_alive:!1,death_reason:h.reason};await sS.from("characters").update(s).eq("id",e.id),t(s),alert(`Seu personagem morreu de ${h.reason} aos ${l.age} anos.`);return}t(l),i(null);let u=sE.advanceTime(l,12);r(sE.getCurrentTime(u))},c=async()=>{let s=sE.advanceTime(e,12),{error:a}=await sS.from("characters").update(s).eq("id",e.id);if(a){alert("Erro ao avan\xe7ar tempo: "+a.message);return}t(s),r(sE.getCurrentTime(s));let n=sE.getAgeEvents(s.age).find(e=>e.age===s.age);n&&i(n)};return e.is_alive?(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"character-status p-6",children:[m.jsx("h3",{className:"text-xl font-bold mb-4 text-japan-gold",children:e.name}),(0,m.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,m.jsxs)("div",{children:[m.jsx("div",{className:"text-japan-cream",children:"Profiss\xe3o:"}),m.jsx("div",{className:"text-japan-gold font-bold",children:e.profession||"Ferreiro"})]}),(0,m.jsxs)("div",{children:[m.jsx("div",{className:"text-japan-cream",children:"Origem:"}),m.jsx("div",{className:"text-japan-gold font-bold",children:e.clan})]}),(0,m.jsxs)("div",{children:[m.jsx("div",{className:"text-japan-cream",children:"Localiza\xe7\xe3o:"}),m.jsx("div",{className:"text-japan-gold font-bold",children:e.current_location||"Vila de origem"})]}),(0,m.jsxs)("div",{children:[m.jsx("div",{className:"text-japan-cream",children:"Status:"}),m.jsx("div",{className:"text-japan-gold font-bold",children:e.is_alive?"Vivo":"Morto"})]}),(0,m.jsxs)("div",{children:[m.jsx("div",{className:"text-japan-cream",children:"Hor\xe1rio:"}),m.jsx("div",{className:"text-japan-gold font-bold",children:gameTime})]})]}),e.travel_reason&&m.jsx("div",{className:"mt-4 p-3 bg-japan-black rounded",children:(0,m.jsxs)("div",{className:"text-japan-cream text-sm",children:[m.jsx("strong",{children:"Motivo da viagem:"})," ",e.travel_reason]})})]}),(0,m.jsxs)("div",{className:"flex gap-2 mb-6 flex-wrap",children:[m.jsx("button",{onClick:()=>setCurrentView("status"),className:`japan-button px-4 py-2 ${"status"===currentView?"bg-japan-red":""}`,children:"\uD83D\uDCCB Status"}),m.jsx("button",{onClick:()=>setCurrentView("combat"),className:`japan-button px-4 py-2 ${"combat"===currentView?"bg-japan-red":""}`,children:" Combate"}),m.jsx("button",{onClick:()=>setCurrentView("occult"),className:`japan-button px-4 py-2 ${"occult"===currentView?"bg-japan-red":""}`,children:"\uD83C\uDF11 Oculto"}),m.jsx("button",{onClick:()=>setCurrentView("secrets"),className:`japan-button px-4 py-2 ${"secrets"===currentView?"bg-japan-red":""}`,children:"\uD83C\uDF11 Caminhos"}),m.jsx("button",{onClick:()=>setCurrentView("encounters"),className:`japan-button px-4 py-2 ${"encounters"===currentView?"bg-japan-red":""}`,children:"\uD83D\uDC41 Encontros"})]}),"status"===currentView&&(0,m.jsxs)("div",{className:"text-sm text-japan-cream opacity-70",children:[(0,m.jsxs)("p",{children:["\uD83C\uDF05 ",m.jsx("strong",{children:"Bem-vindo ao Jap\xe3o feudal"})]}),(0,m.jsxs)("p",{children:["\uD83D\uDC65 ",m.jsx("strong",{children:"Voc\xea \xe9 uma pessoa comum tentando sobreviver"})]}),(0,m.jsxs)("p",{children:["\uD83D\uDDFA ",m.jsx("strong",{children:"O mapa mostra suas op\xe7\xf5es de viagem"})]}),(0,m.jsxs)("p",{children:[" ",m.jsx("strong",{children:"Evite conflitos sempre que poss\xedvel"})]})]}),"combat"===currentView&&m.jsx(CombatSystem,{characterId:e.id,onCombatEnd:e=>{console.log("Combat result:",e),e.playerInjured&&alert("Seu personagem sofreu ferimentos e precisar\xe1 de descanso."),e.playerGainedExperience&&alert("Seu personagem aprendeu algo com essa experi\xeancia.")}}),"occult"===currentView&&m.jsx(OccultSystem,{characterId:e.id,onOccultEvent:e=>{console.log("Occult event:",e),e.perceptionGained&&alert("Sua percep\xe7\xe3o do oculto aumentou!"),e.spiritualResistanceGained&&alert("Sua resist\xeancia espiritual aumentou!")}}),"secrets"===currentView&&m.jsx(SecretSociety,{characterId:e.id,onSecretDiscovered:e=>{console.log("Secret discovered:",e),alert(`Voc\xea descobriu o caminho secreto: ${e.name}!`)}}),"encounters"===currentView&&m.jsx(CreatureEncounters,{characterId:e.id,onEncounter:e=>{console.log("Creature encounter:",e),alert(`Encontro an\xf4malo: ${e.name}`)}}),a&&(0,m.jsxs)("div",{className:"japan-border p-6 bg-japan-black",children:[m.jsx("h3",{className:"text-xl font-bold mb-4 text-japan-red",children:a.title}),m.jsx("p",{className:"text-scene mb-6",children:a.description}),m.jsx("div",{className:"space-y-3",children:a.choices.map((e,t)=>m.jsx("button",{onClick:()=>l(e),className:"japan-button w-full text-left p-4",children:e.text},t))})]}),!a&&(0,m.jsxs)("div",{className:"japan-border p-6 bg-japan-black text-center",children:[m.jsx("p",{className:"text-scene mb-4",children:"O tempo passa calmamente no Jap\xe3o feudal..."}),m.jsx("button",{onClick:c,className:"japan-button px-8 py-3",children:"Avan\xe7ar 1 Ano"})]}),n.length>0&&(0,m.jsxs)("div",{className:"japan-border p-4 bg-japan-black",children:[m.jsx("h4",{className:"text-sm font-bold mb-2 text-japan-gold",children:"Hist\xf3rico"}),m.jsx("div",{className:"text-xs space-y-1 max-h-32 overflow-y-auto",children:n.map((e,t)=>m.jsx("div",{className:"text-japan-cream opacity-80",children:e},t))})]})]}):(0,m.jsxs)("div",{className:"japan-border p-8 bg-japan-black",children:[m.jsx("h2",{className:"text-2xl font-bold text-center mb-6 text-japan-red",children:"Fim da Jornada"}),(0,m.jsxs)("div",{className:"text-center text-scene",children:[(0,m.jsxs)("p",{className:"mb-4",children:["Seu personagem ",e.name," viveu uma vida completa no per\xedodo Sengoku."]}),(0,m.jsxs)("p",{className:"mb-4",children:["Morreu aos ",e.age," anos de ",e.death_reason||"causas naturais","."]}),(0,m.jsxs)("p",{className:"text-japan-gold",children:["Honra final: ",e.honor," | Ouro acumulado: ",e.gold]})]})]})}function sO({userId:e,onSelectCharacter:t}){let[s,r]=(0,g.useState)([]),[a,i]=(0,g.useState)(null),[n,o]=(0,g.useState)(!0);(0,g.useEffect)(()=>{l()},[e]);let l=async()=>{let{data:t,error:s}=await sS.from("characters").select("*").eq("user_id",e).order("created_at",{ascending:!1});s?console.error("Erro ao carregar personagens:",s):r(t||[]),o(!1)},c=async e=>{if(!confirm("Tem certeza que deseja deletar este personagem?"))return;let{error:t}=await sS.from("characters").delete().eq("id",e);t?alert("Erro ao deletar personagem: "+t.message):(r(t=>t.filter(t=>t.id!==e)),a?.id===e&&i(null))};return n?m.jsx("div",{className:"text-japan-cream",children:"Carregando personagens..."}):a?(0,m.jsxs)("div",{children:[m.jsx("button",{onClick:()=>i(null),className:"japan-button mb-4",children:" Voltar para Personagens"}),m.jsx(sT,{character:a,onCharacterUpdate:e=>{r(t=>t.map(t=>t.id===e.id?e:t)),i(e)}})]}):(0,m.jsxs)("div",{className:"space-y-6",children:[m.jsx("h2",{className:"text-2xl font-bold text-japan-red",children:"Seus Personagens"}),0===s.length?(0,m.jsxs)("div",{className:"japan-border p-8 bg-japan-black text-center",children:[m.jsx("p",{className:"text-japan-cream mb-4",children:"Voc\xea ainda n\xe3o tem personagens criados."}),m.jsx("p",{className:"text-japan-cream",children:"Volte para a p\xe1gina inicial e crie seu primeiro personagem!"})]}):m.jsx("div",{className:"grid gap-4",children:s.map(e=>m.jsx("div",{className:"japan-border p-6 bg-japan-black",children:(0,m.jsxs)("div",{className:"flex justify-between items-start",children:[(0,m.jsxs)("div",{className:"flex-1",children:[m.jsx("h3",{className:"text-xl font-bold text-japan-gold mb-2",children:e.name}),(0,m.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-japan-cream",children:[(0,m.jsxs)("div",{children:[m.jsx("span",{className:"text-japan-gold",children:"Idade:"})," ",e.age," anos"]}),(0,m.jsxs)("div",{children:[m.jsx("span",{className:"text-japan-gold",children:"Origem:"})," ",e.clan]}),(0,m.jsxs)("div",{children:[m.jsx("span",{className:"text-japan-gold",children:"Status:"})," ",e.is_alive?"Vivo":"Morto"]}),(0,m.jsxs)("div",{children:[m.jsx("span",{className:"text-japan-gold",children:"Honra:"})," ",e.honor]})]}),!e.is_alive&&(0,m.jsxs)("div",{className:"mt-2 text-sm text-japan-red",children:["Causa da morte: ",e.death_reason||"Desconhecida"]})]}),(0,m.jsxs)("div",{className:"flex gap-2",children:[t&&m.jsx("button",{onClick:()=>t(e),className:"japan-button px-4 py-2 text-sm",children:"\uD83D\uDDFA Mapa"}),m.jsx("button",{onClick:()=>i(e),className:"japan-button px-4 py-2",children:e.is_alive?"Jogar":"Ver Hist\xf3ria"}),m.jsx("button",{onClick:()=>c(e.id),className:"px-4 py-2 border border-japan-red text-japan-red hover:bg-japan-red hover:text-japan-cream transition-colors",children:"Deletar"})]})]})},e.id))})]})}function sR({userId:e}){let[t,s]=(0,g.useState)([]),[r,a]=(0,g.useState)([]),[i,n]=(0,g.useState)(""),[o,l]=(0,g.useState)(!0);(0,g.useEffect)(()=>{c(),h();let e=sS.channel("friends_status").on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles"},e=>{s(t=>t.map(t=>t.id===e.new.id?{...t,is_online:e.new.is_online}:t))}).subscribe();return()=>{e.unsubscribe()}},[e]);let c=async()=>{let{data:t,error:r}=await sS.from("friends").select(`
        friend_id,
        profiles!friend_id (
          id,
          username,
          full_name,
          is_online,
          last_seen
        )
      `).eq("user_id",e);t&&!r&&s(t.map(e=>e.profiles).filter(e=>null!==e).map(e=>({id:e.id,username:e.username,full_name:e.full_name,is_online:e.is_online,last_seen:e.last_seen}))),l(!1)},h=async()=>{let{data:t,error:s}=await sS.from("friend_requests").select(`
        id,
        sender_id,
        sender_username,
        created_at
      `).eq("receiver_id",e).eq("status","pending");t&&!s&&a(t.map(t=>({id:t.id,sender_id:t.sender_id,receiver_id:e,sender_username:t.sender_username,created_at:t.created_at})))},u=async()=>{if(!i.trim())return;let{data:t,error:s}=await sS.from("profiles").select("id, username").eq("email",i.trim()).single();if(s||!t){alert("Usu\xe1rio n\xe3o encontrado");return}let{data:r}=await sS.from("friends").select("id").or(`(user_id.eq.${e},friend_id.eq.${t.id}),(user_id.eq.${t.id},friend_id.eq.${e})`).single();if(r){alert("Voc\xeas j\xe1 s\xe3o amigos");return}let{error:a}=await sS.from("friend_requests").insert({sender_id:e,receiver_id:t.id,sender_username:(await sS.from("profiles").select("username").eq("id",e).single()).data?.username});a?alert("Erro ao enviar solicita\xe7\xe3o: "+a.message):(alert("Solicita\xe7\xe3o enviada!"),n(""))},d=async(t,s)=>{let{error:r}=await sS.from("friends").insert([{user_id:e,friend_id:s},{user_id:s,friend_id:e}]);if(r){alert("Erro ao aceitar solicita\xe7\xe3o: "+r.message);return}let{error:i}=await sS.from("friend_requests").update({status:"accepted"}).eq("id",t);i?alert("Erro ao atualizar solicita\xe7\xe3o: "+i.message):(a(e=>e.filter(e=>e.id!==t)),c())},p=async e=>{let{error:t}=await sS.from("friend_requests").update({status:"rejected"}).eq("id",e);t?alert("Erro ao rejeitar solicita\xe7\xe3o: "+t.message):a(t=>t.filter(t=>t.id!==e))},f=async e=>{alert(`Convite enviado para o amigo! (ID: ${e})`)};return o?m.jsx("div",{className:"text-japan-cream",children:"Carregando amigos..."}):(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"character-status p-4",children:[m.jsx("h3",{className:"text-xl font-bold mb-4 text-japan-gold",children:"\uD83D\uDC65 Adicionar Amigo"}),(0,m.jsxs)("div",{className:"flex gap-2",children:[m.jsx("input",{type:"email",value:i,onChange:e=>n(e.target.value),placeholder:"Email do amigo",className:"flex-1 p-2 japan-input text-japan-cream"}),m.jsx("button",{onClick:u,className:"japan-button px-4 py-2",children:"Enviar"})]})]}),r.length>0&&(0,m.jsxs)("div",{className:"character-status p-4",children:[m.jsx("h3",{className:"text-xl font-bold mb-4 text-japan-gold",children:"\uD83D\uDCE8 Solicita\xe7\xf5es"}),m.jsx("div",{className:"space-y-2",children:r.map(e=>(0,m.jsxs)("div",{className:"flex items-center justify-between p-2 bg-japan-black rounded",children:[m.jsx("span",{className:"text-japan-cream",children:e.sender_username}),(0,m.jsxs)("div",{className:"flex gap-2",children:[m.jsx("button",{onClick:()=>d(e.id,e.sender_id),className:"japan-button px-3 py-1 text-sm",children:"Aceitar"}),m.jsx("button",{onClick:()=>p(e.id),className:"japan-button px-3 py-1 text-sm",children:"Recusar"})]})]},e.id))})]}),(0,m.jsxs)("div",{className:"character-status p-4",children:[m.jsx("h3",{className:"text-xl font-bold mb-4 text-japan-gold",children:"\uD83D\uDC65 Amigos"}),0===t.length?m.jsx("p",{className:"text-japan-cream opacity-60",children:"Nenhum amigo adicionado ainda"}):m.jsx("div",{className:"space-y-2",children:t.map(e=>(0,m.jsxs)("div",{className:"flex items-center justify-between p-3 bg-japan-black rounded",children:[(0,m.jsxs)("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:`w-3 h-3 rounded-full ${e.is_online?"bg-green-500":"bg-gray-500"}`}),(0,m.jsxs)("div",{children:[m.jsx("div",{className:"text-japan-cream font-medium",children:e.username}),m.jsx("div",{className:"text-japan-cream opacity-60 text-sm",children:e.is_online?"Online":`Offline: ${new Date(e.last_seen).toLocaleDateString()}`})]})]}),m.jsx("div",{className:"flex gap-2",children:e.is_online&&m.jsx("button",{onClick:()=>f(e.id),className:"japan-button px-3 py-1 text-sm",children:"\uD83C\uDF8C Convidar"})})]},e.id))})]})]})}function sA({characterId:e}){let[t,s]=(0,g.useState)(null),[r,a]=(0,g.useState)([]),[i,n]=(0,g.useState)(null),[o,l]=(0,g.useState)(!0);(0,g.useEffect)(()=>{c(),h()},[e]);let c=async()=>{let{data:t,error:r}=await sS.from("characters").select("id, name, current_location, region").eq("id",e).single();t&&!r&&s(t),l(!1)},h=async()=>{let{data:e,error:t}=await sS.from("map_locations").select("*").order("region",{ascending:!0});e&&!t&&a(e)},u=async r=>{if(!t||!r.is_accessible){alert("Localiza\xe7\xe3o n\xe3o acess\xedvel no momento");return}if(r.region!==t.region&&"musashi"!==r.region){alert("Voc\xea precisa desbloquear esta regi\xe3o primeiro");return}let{error:a}=await sS.from("characters").update({current_location:r.name,region:r.region}).eq("id",e);a?alert("Erro ao viajar: "+a.message):(s(e=>e?{...e,current_location:r.name,region:r.region}:null),n(r),alert(`Voc\xea viajou para ${r.name}!`))},d=e=>({owari:"#8B0000",kai:"#2F4F2F",shinano:"#4B0082",mino:"#DAA520",musashi:"#DC143C",echigo:"#4682B4"})[e]||"#666666";return o?m.jsx("div",{className:"text-japan-cream",children:"Carregando mapa..."}):(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsxs)("div",{className:"character-status p-6",children:[m.jsx("h3",{className:"text-2xl font-bold mb-4 text-japan-gold",children:"\uD83D\uDDFA Mapa do Jap\xe3o Sengoku"}),t&&(0,m.jsxs)("div",{className:"mb-4 p-3 bg-japan-black rounded",children:[(0,m.jsxs)("div",{className:"text-japan-cream",children:[m.jsx("span",{className:"font-bold",children:"\uD83D\uDCCD Posi\xe7\xe3o Atual:"})," ",t.current_location]}),(0,m.jsxs)("div",{className:"text-japan-cream opacity-60 text-sm",children:["Regi\xe3o: ",t.region]})]}),m.jsx("div",{className:"relative bg-japan-black rounded p-4",style:{minHeight:"400px"},children:(0,m.jsxs)("svg",{width:"100%",height:"400",viewBox:"0 0 800 600",className:"w-full",children:[r.map(e=>{let s=t?.current_location===e.name,r=e.is_accessible;return(0,m.jsxs)("g",{children:[m.jsx("circle",{cx:e.x,cy:e.y,r:s?12:8,fill:d(e.region),stroke:s?"#FFD700":"#333",strokeWidth:s?3:1,className:"cursor-pointer transition-all hover:opacity-80",onClick:()=>r&&n(e)}),m.jsx("text",{x:e.x,y:e.y-15,textAnchor:"middle",fill:s?"#FFD700":"#F5F5DC",fontSize:"12",className:"pointer-events-none",children:e.name}),!r&&m.jsx("text",{x:e.x,y:e.y+20,textAnchor:"middle",fill:"#666",fontSize:"10",className:"pointer-events-none",children:"\uD83D\uDD12"})]},e.id)}),m.jsx("line",{x1:"400",y1:"300",x2:"200",y2:"200",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"}),m.jsx("line",{x1:"400",y1:"300",x2:"600",y2:"200",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"}),m.jsx("line",{x1:"400",y1:"300",x2:"300",y2:"400",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"}),m.jsx("line",{x1:"400",y1:"300",x2:"500",y2:"400",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"}),m.jsx("line",{x1:"400",y1:"300",x2:"400",y2:"500",stroke:"#444",strokeWidth:"1",strokeDasharray:"5,5"})]})})]}),i&&(0,m.jsxs)("div",{className:"character-status p-4",children:[m.jsx("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:i.name}),m.jsx("p",{className:"text-japan-cream mb-3",children:i.description}),(0,m.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,m.jsxs)("span",{className:"text-japan-cream",children:["Regi\xe3o: ",i.region]}),m.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:d(i.region)}})]}),t?.current_location!==i.name&&m.jsx("button",{onClick:()=>u(i),disabled:!i.is_accessible,className:"japan-button w-full",children:i.is_accessible?"\uD83D\uDEB6 Viajar para este local":"\uD83D\uDD12 Localiza\xe7\xe3o bloqueada"}),t?.current_location===i.name&&m.jsx("div",{className:"text-japan-gold text-center font-bold",children:"\uD83D\uDCCD Voc\xea est\xe1 aqui"})]}),(0,m.jsxs)("div",{className:"character-status p-4",children:[m.jsx("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:"\uD83D\uDCCD Localiza\xe7\xf5es"}),m.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:r.map(e=>{let s=t?.current_location===e.name;return(0,m.jsxs)("div",{className:`p-2 rounded cursor-pointer transition-all ${s?"bg-japan-gold text-japan-black":"bg-japan-black text-japan-cream hover:bg-japan-red"}`,onClick:()=>n(e),children:[(0,m.jsxs)("div",{className:"flex items-center justify-between",children:[(0,m.jsxs)("span",{className:"font-medium",children:[e.name," ",s&&"\uD83D\uDCCD"]}),(0,m.jsxs)("div",{className:"flex items-center gap-2",children:[m.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:d(e.region)}}),!e.is_accessible&&m.jsx("span",{children:"\uD83D\uDD12"})]})]}),m.jsx("div",{className:"text-sm opacity-70",children:e.region})]},e.id)})})]})]})}function sN({onClick:e,children:t,className:s="",type:r="button",disabled:a=!1}){return m.jsx("button",{onClick:e,type:r,disabled:a,className:`japan-button ${s}`,style:{cursor:a?"not-allowed":"pointer",opacity:a?.6:1,pointerEvents:"auto"},children:t})}async function sC(e){if(!e)return null;let{data:t}=await sS.from("profiles").select("*").eq("id",e.id).single();if(t)return t;let{data:s,error:r}=await sS.from("profiles").insert({id:e.id,username:e.user_metadata?.username||e.email?.split("@")[0]||"user_"+e.id.slice(0,8),full_name:e.user_metadata?.full_name||e.user_metadata?.username||e.email?.split("@")[0]||"Usu\xe1rio"}).select().single();return r?(console.error("Erro ao criar perfil:",r),null):s}function s$(){let[e,t]=(0,g.useState)(!1),[s,r]=(0,g.useState)(null),[a,i]=(0,g.useState)(!0),[n,o]=(0,g.useState)(""),[l,c]=(0,g.useState)("ferreiro"),[h,u]=(0,g.useState)("owari"),[d,p]=(0,g.useState)(""),[f,y]=(0,g.useState)(!1),[w,b]=(0,g.useState)(!1),[v,_]=(0,g.useState)(!1),[x,j]=(0,g.useState)(null);(0,g.useEffect)(()=>{(async()=>{let{data:{user:e}}=await sS.auth.getUser();r(e),e&&await sC(e),i(!1)})();let{data:{subscription:e}}=sS.auth.onAuthStateChange(async(e,t)=>{r(t?.user??null),t?.user&&await sC(t.user)});return()=>e.unsubscribe()},[]);let k=async()=>{if(!s||!n.trim())return;await sC(s);let{error:e}=await sS.from("characters").insert({user_id:s.id,name:n,age:16,clan:h,profession:l,travel_reason:d,current_location:"Vila de origem",is_alive:!0,honor:50,created_at:new Date().toISOString()});e?alert("Erro ao criar personagem: "+e.message):(alert("Personagem criado com sucesso!"),o(""),c("ferreiro"),u("owari"),p(""),y(!0),t(!1))};return a?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsx("div",{className:"text-japan-cream",children:"Carregando..."})}):s?w?m.jsx("div",{className:"min-h-screen p-4",children:(0,m.jsxs)("div",{className:"max-w-4xl mx-auto",children:[m.jsx("div",{className:"japan-card p-6 mb-6",children:(0,m.jsxs)("div",{className:"flex justify-between items-center",children:[m.jsx("h1",{className:"text-3xl font-bold text-japan-red",children:"\uD83D\uDC65 Amigos"}),(0,m.jsxs)("div",{className:"flex gap-4",children:[m.jsx("button",{onClick:()=>b(!1),className:"japan-button",children:"Voltar"}),(0,m.jsxs)("button",{onClick:()=>sS.auth.signOut(),className:"text-sm text-japan-cream hover:text-japan-gold transition-colors",children:["Sair (",s.email,")"]})]})]})}),m.jsx(sR,{userId:s.id})]})}):v&&x?m.jsx("div",{className:"min-h-screen p-4",children:(0,m.jsxs)("div",{className:"max-w-6xl mx-auto",children:[m.jsx("div",{className:"japan-card p-6 mb-6",children:(0,m.jsxs)("div",{className:"flex justify-between items-center",children:[(0,m.jsxs)("h1",{className:"text-3xl font-bold text-japan-red",children:["\uD83D\uDDFA Mapa - ",x.name]}),(0,m.jsxs)("div",{className:"flex gap-4",children:[m.jsx("button",{onClick:()=>_(!1),className:"japan-button",children:"Voltar"}),(0,m.jsxs)("button",{onClick:()=>sS.auth.signOut(),className:"text-sm text-japan-cream hover:text-japan-gold transition-colors",children:["Sair (",s.email,")"]})]})]})}),m.jsx(sA,{characterId:x.id})]})}):e?m.jsx("div",{className:"min-h-screen flex items-center justify-center p-4",children:m.jsx("div",{className:"max-w-2xl w-full",children:(0,m.jsxs)("div",{className:"japan-card p-8 bg-japan-black",children:[m.jsx("h1",{className:"text-3xl font-bold text-center mb-8 text-japan-red",children:"Cr\xf4nicas do Jap\xe3o"}),(0,m.jsxs)("div",{className:"text-scene mb-8",children:[m.jsx("p",{className:"mb-4",children:"Ano de 1467. O Jap\xe3o est\xe1 mergulhado na Era Sengoku - o Per\xedodo dos Estados em Guerra. A vida cotidiana, o folclore e o sobrenatural se encontram em sil\xeancio."}),(0,m.jsxs)("p",{className:"mb-4",children:["Bem-vindo, ",s?.email||"viajante","! Sua jornada est\xe1 prestes a come\xe7ar..."]})]}),(0,m.jsxs)("div",{className:"character-status",children:[m.jsx("h2",{className:"text-xl font-bold mb-4 text-japan-gold",children:"Cria\xe7\xe3o de Personagem"}),(0,m.jsxs)("div",{className:"space-y-4",children:[(0,m.jsxs)("div",{children:[m.jsx("label",{className:"block text-sm font-medium mb-2",children:"Nome:"}),m.jsx("input",{type:"text",value:n,onChange:e=>o(e.target.value),className:"w-full p-2 japan-input text-japan-cream",placeholder:"Digite seu nome..."})]}),(0,m.jsxs)("div",{children:[m.jsx("label",{className:"block text-sm font-medium mb-2",children:"Origem (Prov\xedncia):"}),(0,m.jsxs)("select",{value:h,onChange:e=>u(e.target.value),className:"w-full p-2 japan-input text-japan-cream",children:[m.jsx("option",{value:"owari",children:"Owari - Plan\xedcies Centrais"}),m.jsx("option",{value:"kai",children:"Kai - Montanhas"}),m.jsx("option",{value:"shinano",children:"Shinano - Interior"}),m.jsx("option",{value:"mino",children:"Mino - Vale"}),m.jsx("option",{value:"musashi",children:"Musashi - Capital"}),m.jsx("option",{value:"echigo",children:"Echigo - Norte"})]})]}),(0,m.jsxs)("div",{children:[m.jsx("label",{className:"block text-sm font-medium mb-2",children:"Profiss\xe3o:"}),(0,m.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"w-full p-2 japan-input text-japan-cream",children:[m.jsx("option",{value:"ferreiro",children:"Ferreiro"}),m.jsx("option",{value:"campones",children:"Campon\xeas"}),m.jsx("option",{value:"mensageiro",children:"Mensageiro"}),m.jsx("option",{value:"monge",children:"Monge novi\xe7o"}),m.jsx("option",{value:"ronin",children:"Ronin"}),m.jsx("option",{value:"artesao",children:"Artes\xe3o"}),m.jsx("option",{value:"comerciante",children:"Comerciante"})]})]}),(0,m.jsxs)("div",{children:[m.jsx("label",{className:"block text-sm font-medium mb-2",children:"Motivo da viagem / mudan\xe7a:"}),m.jsx("textarea",{value:n,onChange:e=>o(e.target.value),className:"w-full p-2 japan-input text-japan-cream",placeholder:"Ex: Perdi a oficina em um inc\xeandio e precisei me mudar...",rows:3})]}),(0,m.jsxs)("div",{className:"text-sm text-japan-cream opacity-70",children:[(0,m.jsxs)("p",{className:"mb-2",children:["\uD83D\uDCDD ",m.jsx("strong",{children:"Seu personagem \xe9 um humano comum"}),", sem poderes especiais ou destino \xe9pico."]}),(0,m.jsxs)("p",{className:"mb-2",children:["\uD83C\uDFAD ",m.jsx("strong",{children:"Seus atributos ser\xe3o definidos por suas escolhas"})," durante o question\xe1rio narrativo."]}),(0,m.jsxs)("p",{children:[" ",m.jsx("strong",{children:"Combate \xe9 raro e perigoso"})," - fugir sempre \xe9 uma op\xe7\xe3o v\xe1lida."]})]}),m.jsx("button",{onClick:k,className:"japan-button w-full",children:"Criar Personagem"})]})]})]})})}):f?m.jsx("div",{className:"min-h-screen p-4",children:(0,m.jsxs)("div",{className:"max-w-4xl mx-auto",children:[m.jsx("div",{className:"japan-card p-6 mb-6",children:(0,m.jsxs)("div",{className:"flex justify-between items-center",children:[m.jsx("h1",{className:"text-3xl font-bold text-japan-red",children:"Cr\xf4nicas do Jap\xe3o"}),(0,m.jsxs)("div",{className:"flex gap-4",children:[m.jsx("button",{onClick:()=>b(!0),className:"japan-button",children:"\uD83D\uDC65 Amigos"}),m.jsx("button",{onClick:()=>y(!1),className:"japan-button",children:"Novo Personagem"}),(0,m.jsxs)("button",{onClick:()=>sS.auth.signOut(),className:"text-sm text-japan-cream hover:text-japan-gold transition-colors",children:["Sair (",s.email,")"]})]})]})}),m.jsx(sO,{userId:s.id,onSelectCharacter:e=>{j(e),_(!0)}})]})}):void 0:m.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:m.jsx("div",{className:"max-w-5xl w-full relative z-10",children:(0,m.jsxs)("div",{className:"japan-card p-12 text-center",children:[(0,m.jsxs)("div",{className:"mb-8",children:[m.jsx("h1",{className:"text-6xl font-bold mb-4 japan-title",children:"\uD83C\uDFEF Cr\xf4nicas do Jap\xe3o"}),m.jsx("div",{className:"samurai-divider"})]}),(0,m.jsxs)("div",{className:"text-scene mb-16 max-w-4xl mx-auto",children:[m.jsx("h2",{className:"text-4xl font-bold mb-8 text-japan-gold",children:"\uD83C\uDF11 Um Jap\xe3o esquecido observa voc\xea."}),m.jsx("p",{className:"text-xl mb-6 leading-relaxed",children:"Nem todos os horrores vivem nos contos. Alguns caminham pelas estradas, se escondem nos templos e observam aqueles que ainda n\xe3o despertaram."}),m.jsx("p",{className:"text-xl mb-6 leading-relaxed",children:"Cr\xf4nicas do Jap\xe3o \xe9 um RPG narrativo ambientado no per\xedodo Sengoku, onde a vida cotidiana, o folclore e o sobrenatural se encontram em sil\xeancio."}),m.jsx("p",{className:"text-xl mb-8 leading-relaxed",children:"Voc\xea come\xe7a como uma pessoa comum  campon\xeas, mercador, monge, soldado  sem saber que o mundo guarda algo al\xe9m do vis\xedvel. Conforme sua hist\xf3ria se desenvolve, suas escolhas moldam seu corpo, sua mente e sua percep\xe7\xe3o do oculto at\xe9 o dia em que voc\xea n\xe3o pode mais fingir que n\xe3o v\xea."}),m.jsx("p",{className:"text-2xl font-bold text-japan-gold",children:" Escreva sua hist\xf3ria. Viva. Desperte."})]}),(0,m.jsxs)("div",{className:"character-status p-8 mb-16",children:[m.jsx("h3",{className:"text-2xl font-bold mb-6 text-japan-red",children:"\uD83D\uDD6F O Que Aguarda"}),(0,m.jsxs)("div",{className:"mb-6",children:[m.jsx("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:"\uD83E\uDDED Evolu\xe7\xe3o Silenciosa"}),m.jsx("p",{className:"text-base leading-relaxed text-japan-cream",children:"Nada acontece de uma vez. Cada decis\xe3o, rotina ou erro molda seu corpo, sua mente e aquilo que voc\xea ser\xe1 capaz de perceber."})]}),(0,m.jsxs)("div",{className:"mb-6",children:[m.jsx("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:"\uD83D\uDC64 Vidas Comuns"}),m.jsx("p",{className:"text-base leading-relaxed text-japan-cream",children:"Voc\xea come\xe7a invis\xedvel para o mundo. Um rosto entre muitos. Nenhum destino escrito. Nenhuma prote\xe7\xe3o divina."})]}),(0,m.jsxs)("div",{children:[m.jsx("h4",{className:"text-xl font-bold mb-3 text-japan-gold",children:" O Peso do Tempo"}),m.jsx("p",{className:"text-base leading-relaxed text-japan-cream",children:"Os anos passam. O corpo muda. Rela\xe7\xf5es surgem e se desfazem. Voc\xea pode deixar filhos, hist\xf3rias... ou marcas que nunca desaparecem."})]})]}),(0,m.jsxs)("div",{className:"space-y-6 max-w-md mx-auto",children:[m.jsx(sN,{onClick:()=>{console.log("Bot\xe3o Entrar clicado"),t(!0)},className:"text-2xl px-16 py-8 w-full font-bold",children:"\uD83D\uDEAA Entrar"}),m.jsx("div",{className:"samurai-divider"}),m.jsx("div",{className:"text-base text-japan-cream opacity-80",children:"\uD83C\uDF8C Sistema de RPG de Vida  Jap\xe3o Sengoku  Progress\xe3o Org\xe2nica"}),m.jsx("div",{className:"text-sm text-japan-cream opacity-60",children:'\uD83C\uDF1F "O mundo n\xe3o gira ao seu redor"'})]})]})})})}},2295:(e,t,s)=>{"use strict";e.exports=s(6372).vendored["react-ssr"].ReactJsxRuntime},2917:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o,metadata:()=>n});var r=s(5036),a=s(265),i=s.n(a);s(7272);let n={title:"Cr\xf4nicas do Jap\xe3o - RPG de Texto",description:"Um RPG de texto ambientado no per\xedodo Sengoku do Jap\xe3o"};function o({children:e}){return r.jsx("html",{lang:"pt-BR",children:r.jsx("body",{className:`${i().className} bg-japan-black text-japan-cream min-h-screen`,children:e})})}},751:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let r=(0,s(6843).createProxy)(String.raw`C:\Users\hvgau.LAPTOP-7C6COKFO\Documents\projetos\cronicas-do-japao\app\page.tsx`),{__esModule:a,$$typeof:i}=r,n=r.default},7272:()=>{}};var t=require("../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[869],()=>s(5578));module.exports=r})();